<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>Write a control panel for my API-based CMS for Nuxt | Jenny的小站</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="date" name="date" content="2020-04-26"><meta data-n-head="ssr" data-hid="description" name="description" content="April CMS, a CMS that operates text files and serves with both interface and API, built for serving blog contents, come and check it out~"><meta data-n-head="ssr" data-hid="keyword" name="keyword" content="JavaScript,Node.js,jQuery,My Project,Tech"><base href="/"><link data-n-head="ssr" rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/css/font-gugi.css"><link data-n-head="ssr" rel="stylesheet" href="/css/font-poppins.css"><link data-n-head="ssr" rel="stylesheet" href="/css/style.css?2021-02-14-1"><link data-n-head="ssr" rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><link data-n-head="ssr" rel="stylesheet" href="https://hzn-website.000webhostapp.com/disqus/dist/iDisqus.min.css"><script data-n-head="ssr" src="/js/statcounter.js"></script><link rel="preload" href="/_nuxt/e5fa922.js" as="script"><link rel="preload" href="/_nuxt/bb5f8ec.js" as="script"><link rel="preload" href="/_nuxt/e4d6bd6.js" as="script"><link rel="preload" href="/_nuxt/092fd27.js" as="script"><link rel="preload" href="/_nuxt/525861d.js" as="script"><style data-vue-ssr-id="89dfa84c:0 019e1cef:0 72520070:0 1da8fc0f:0 f28bdea2:0">code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#75a7ca}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#75a7ca}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;color:#db4c69;background:#f9f2f4}.namespace{opacity:.7}.token.doctype .token.doctype-tag{color:#569cd6}.token.doctype .token.name{color:#9cdcfe}.token.comment,.token.prolog{color:#6a9955}.language-html .language-css .token.punctuation,.language-html .language-javascript .token.punctuation,.token.punctuation{color:#d4d4d4}.token.boolean,.token.constant,.token.inserted,.token.number,.token.property,.token.symbol,.token.tag,.token.unit{color:#b5cea8}.token.attr-name,.token.builtin,.token.char,.token.deleted,.token.selector,.token.string{color:#ce9178}.language-css .token.string.url{text-decoration:underline}.token.entity,.token.operator{color:#d4d4d4}.token.operator.arrow{color:#569cd6}.token.atrule{color:#ce9178}.token.atrule .token.rule{color:#c586c0}.token.atrule .token.url{color:#9cdcfe}.token.atrule .token.url .token.function{color:#dcdcaa}.token.atrule .token.url .token.punctuation{color:#d4d4d4}.token.keyword{color:#569cd6}.token.keyword.control-flow,.token.keyword.module{color:#c586c0}.token.function,.token.function .token.maybe-class-name{color:#dcdcaa}.token.regex{color:#d16969}.token.important{color:#569cd6}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name,.token.maybe-class-name{color:#4ec9b0}.token.console,.token.interpolation,.token.parameter{color:#9cdcfe}.token.boolean,.token.punctuation.interpolation-punctuation{color:#569cd6}.token.exports .token.maybe-class-name,.token.imports .token.maybe-class-name,.token.property,.token.variable{color:#9cdcfe}.token.escape,.token.selector{color:#d7ba7d}.token.tag{color:#569cd6}.token.cdata,.token.tag .token.punctuation{color:grey}.token.attr-name{color:#9cdcfe}.token.attr-value,.token.attr-value .token.punctuation{color:#ce9178}.token.attr-value .token.punctuation.attr-equals{color:#d4d4d4}.token.entity{color:#569cd6}.token.namespace{color:#4ec9b0}code[class*=language-javascript],code[class*=language-jsx],code[class*=language-tsx],code[class*=language-typescript],pre[class*=language-javascript],pre[class*=language-jsx],pre[class*=language-tsx],pre[class*=language-typescript]{color:#9cdcfe}code[class*=language-css],pre[class*=language-css]{color:#ce9178}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-regex .token.anchor{color:#dcdcaa}.language-html .token.punctuation{color:grey}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0;pointer-events:none;line-height:inherit;white-space:pre}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.nuxt-content{margin-bottom:50px}.nuxt-content h2{margin:9px 18px;padding:9px 0}.nuxt-content h3,.nuxt-content h4,.nuxt-content h5{margin:0 18px;padding:0}.nuxt-content h2,.nuxt-content h3{border-bottom:1px solid silver}.nuxt-content h2{font-size:30px}.nuxt-content h3{font-size:28px}.nuxt-content h4{font-size:24px}.nuxt-content h5{font-size:20px}.nuxt-content p{margin-left:18px;margin-right:18px;line-height:24px}.nuxt-content ol{padding-right:18px}.nuxt-content li{line-height:24px}.nuxt-content li p{margin:0}.nuxt-content iframe{margin:8px auto 8px 0;width:400px;height:300px;display:block}.nuxt-content blockquote{margin:16px 18px;padding:10px;color:#6a737d;background-color:#f8f8f8;border-left:.25em solid #dfe2e5}.nuxt-content img{max-height:100px;max-width:600px;border:1px solid silver}.nuxt-content pre{margin-left:18px;margin-right:18px;border-radius:4px}.nuxt-content code,.nuxt-content li p code{padding:4px;color:#d4d4d4;vertical-align:top;background:#1e1e1e;border-radius:4px;display:inline}.nuxt-content a,.toc a,.toc a:active,.toc a:visited{color:#000;font-weight:700}.nuxt-content a:hover,.toc a:hover{color:grey}li.toc3{list-style:circle;transform:translateX(15px)}a[id]{position:relative;top:-40px;display:block}a#comment-link{top:0}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}#disqus_thread{margin-top:20px}.prev-next{margin:20px auto;display:block}.prev-next:after{display:table;content:" ";clear:both}.prev-next a{display:inline}.next,.prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:20px auto;width:100%;color:grey;border:1px solid grey;cursor:pointer}.prev{margin-left:18px;width:46%;text-align:left;float:left}.next{margin-right:18px;width:46%;text-align:right;float:right}.next:hover,.prev:hover{color:#000;border-color:#000}.next p,.prev p{margin:14px;padding:0;height:46px;overflow:hidden}#comment{margin:40px 18px 0}@media (max-width:768px){.nuxt-content h2,.nuxt-content h3,.nuxt-content h4,.nuxt-content h5{margin:9px 0}.nuxt-content blockquote{margin:16px 0}.nuxt-content img{max-width:100%}.nuxt-content p{margin-left:0;margin-right:0}.nuxt-content iframe{margin:8px auto;width:100%;height:auto}.nuxt-content ul{padding-left:20px}.nuxt-content pre{margin-left:0;margin-right:0}.next,.prev{margin:0}.next p,.prev p{margin:8px;padding:0}.next .title,.prev .title{font-size:12px}#comment{margin:40px 0 0}}.pic-showcase{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.pic-showcase-unit-2,.pic-showcase-unit-3{position:relative;margin:20px;border:1px solid silver;border-radius:5px;overflow:hidden}.pic-showcase-unit-2{width:45%}.pic-showcase-unit-3{width:29%}.pic-showcase-unit-4{position:relative;margin:20px 10px 0;width:22%;border:1px solid silver;border-radius:5px;overflow:hidden}.pic-showcase-bg{width:100%;background:no-repeat top;background-size:cover;border:2px solid #fff;border-radius:6px}.rectangle-bottom{border-bottom-left-radius:0;border-bottom-right-radius:0}.pic-showcase-unit-tag{position:absolute;left:5px;bottom:5px;padding:2px 8px;font-size:12px;background:#e1e1e1;border:1px solid hsla(0,0%,50.2%,.3);border-radius:16px}.pic-showcase-text-left{left:0;bottom:0;width:100%;height:100%;display:table-cell;vertical-align:middle;color:#fff;background:rgba(0,0,0,.7);transform:translateX(-100%);transition:transform .5s;justify-content:center;display:flex}.pic-showcase-text-left div{position:absolute;top:50%;left:50%;width:90%;transform:translate(-50%,-50%)}.pic-showcase-text-bottom{position:absolute;left:0;bottom:0;width:100%;color:#fff;background:rgba(0,0,0,.7);transform:translateY(100%);transition:transform .5s}.pic-showcase-text-below{left:0;bottom:0;width:100%;height:50%}.pic-showcase-unit-2 .pic-showcase-text-bottom{height:50%;display:table}.pic-showcase-unit-2 .pic-showcase-text-bottom div{padding:20px;display:table-cell;vertical-align:middle}.pic-showcase-unit-2:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-2:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-unit-3:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-3:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-unit-4:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-4:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-title{margin:0 5px;padding:16px 0;text-align:center}.pic-showcase-title span.title{font-weight:700}.h-auto .pic-showcase-title{padding:8px 0 10px}.h-auto .pic-showcase-title span.title{max-height:108px;display:block;overflow:hidden}.pic-showcase-unit-4.h-auto .pic-showcase-title span.title{font-size:16px;font-weight:400;line-height:18px;max-height:92px}.h-200{height:200px}.h-300{height:300px}.h-400{height:400px}.h-500{height:500px}.h-full{height:100%}.h-half{height:50%}.h-auto{height:auto}.pos-relative{position:relative}.pos-absolute{position:absolute}@media (max-width:1024px){.pic-showcase-unit-2{margin:0 10px 20px}.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-text-left{transform:translateX(0);position:relative}}@media (max-width:768px){.h-300,.pic-showcase-unit-2,.pic-showcase-unit-4{height:200px}.pic-showcase-unit-2{width:44%}.pic-showcase-unit-3{margin:0 10px 10px;width:45%}.h-auto{height:auto}.h-auto .h-200{height:140px}.pic-showcase-unit-4{width:22%}}@media (max-width:539px){.pic-showcase-unit-2{margin:0 5px 10px;width:100%}.pic-showcase-unit-3{margin:0 5px 10px;width:47%}.pic-showcase-unit-4{margin-left:5px;margin-right:5px;width:46%}.mobile-hidden{display:none}}@media (max-width:425px){.pic-showcase-unit-3{width:48%}}.blog-gallery{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.blog-gallery-unit{margin:40px 20px 0;width:46%;border:1px solid silver;border-radius:5px}.blog-gallery-unit:first-child,.blog-gallery-unit:nth-child(2){margin-top:20px}.blog-gallery-unit:nth-child(2n-1){margin-left:0}.blog-gallery-unit:nth-child(2n){margin-right:0}.blog-gallery-unit:hover{border-color:#000}.blog-gallery-inner{padding:21px 10px 10px;height:100%}.blog-gallery-inner h4{margin-top:0;max-height:42px;overflow:hidden}.blog-gallery-desc{line-height:21px;max-height:64px;display:block;overflow:hidden}.blog-gallery-tag{margin:1px;padding:0 8px;color:#fff;font-size:12px;font-family:"Microsoft Yahei";line-height:20px;border-radius:999px;background:grey;display:inline-block}.blog-gallery-lang{display:inline-block;width:60px;font-size:14px;text-align:center;color:grey;border:1px solid silver;border-radius:4px}@media (max-width:768px){.blog-gallery-unit:nth-child(2n-1){margin-right:15px}.blog-gallery-unit:nth-child(2n){margin-left:15px}}@media (max-width:425px){.blog-gallery-unit{margin:20px 0 0;width:100%}.blog-gallery-unit:nth-child(2n-1){margin-right:0}.blog-gallery-unit:nth-child(2n){margin-left:0}}</style><link rel="preload" href="/_nuxt/static/1613379781/blog/editor-for-my-cms-of-my-nuxt-blog-en/state.js" as="script"><link rel="preload" href="/_nuxt/static/1613379781/blog/editor-for-my-cms-of-my-nuxt-blog-en/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1613379781/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav><div class="nav-wrap"><header><a href="/" class="no-decor-link"><p class="nav-home">Jenny's blog</p></a></header> <div class="nav-btn"><div class="bar"></div> <div class="bar"></div> <div class="bar"></div> <div class="bar"></div></div> <div class="nav-mask"></div> <div class="body-mask"></div> <ul class="nav-ul"><span title="将UI文本切换成中文" class="nav-link" style="padding-left:10px">
      中文
    </span> <a href="/" target="_self" class="nav-link"><li>Home<!----><!----></li></a><a href="/resume" target="_self" class="nav-link"><li>Resume<!----><!----></li></a><a href="/portfolio" target="_self" class="nav-link"><li>Portfolio<!----><!----></li></a><a href="/blog" target="_self" class="nav-link nuxt-link-active"><li>Blog<!----><!----></li></a><a href="/store" target="_self" class="nav-link"><li>Store<!----><!----></li></a><a href="https://wj.qq.com/s2/3731207/f0cd/" target="_blank" class="nav-link"><li>Contact<span> </span><i class="fa fa-external-link"></i></li></a></ul></div></nav> <main><p class="breadcrumbs"><span><a href="/">Home</a><!----><span> / </span></span><span><a href="/blog">Blog</a><!----><span> / </span></span><span><!----><span>editor-for-my-cms-of-my-nuxt-blog-en</span><!----></span></p> <div><section class="main-content"><h1 class="align-center article-title">Write a control panel for my API-based CMS for Nuxt</h1> <p class="align-center"><span class="blog-date"><i class="fa fa-calendar"></i>
        2020-04-26
      </span> <a href="/blog/language/English"><span class="blog-lang">English</span></a> <span style="font-size:14px;color:gray">
        12 min read
      </span></p> <p class="blog-tags align-center"><a href="/blog/tag/JavaScript"><span class="blog-tag">JavaScript</span></a><a href="/blog/tag/Node.js"><span class="blog-tag">Node.js</span></a><a href="/blog/tag/jQuery"><span class="blog-tag">jQuery</span></a><a href="/blog/tag/My Project"><span class="blog-tag">My Project</span></a><a href="/blog/tag/Tech"><span class="blog-tag">Tech</span></a></p> <div class="blog-desc">April CMS, a CMS that operates text files and serves with both interface and API, built for serving blog contents, come and check it out~</div> <article><ul class="toc"><li class="toc2"><a href="#a-true-cms">A true CMS</a></li><li class="toc2"><a href="#what-i-need-for-backend">What I need for backend</a></li><li class="toc2"><a href="#what-i-need-for-front-end">What I need for front-end</a></li><li class="toc2"><a href="#actual-codes-for-backend">Actual codes for backend</a></li><li class="toc3"><a href="#dependencies-for-api">Dependencies for API</a></li><li class="toc3"><a href="#to-return-unrendered-markdown-when-called">To return unrendered Markdown when called</a></li><li class="toc3"><a href="#add-backend-ui-for-api">Add Backend UI for API</a></li><li class="toc3"><a href="#to-save-and-delete-file">To save and delete file</a></li><li class="toc2"><a href="#actual-codes-for-front-end">Actual codes for front-end</a></li><li class="toc3"><a href="#to-call-api-and-markdown">To call API and Markdown</a></li><li class="toc3"><a href="#points-to-notice-when-rendering-markdown">Points to notice when rendering Markdown</a></li><li class="toc3"><a href="#add-smooth-scrolling-effect">Add smooth scrolling effect</a></li><li class="toc2"><a href="#here-is-what-it-looks-like">Here is what it looks like</a></li><li class="toc2"><a href="#experience-from-this">Experience from this</a></li></ul> <div class="nuxt-content"><h2 id="a-true-cms"><a href="#a-true-cms" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>A true CMS</h2>
<p>This is a translation of original article <a href="/blog/editor-for-my-cms-of-my-nuxt-blog">给Nuxt使用的基于API的CMS——还有管理后台呢</a>.</p>
<p>Github repo: <a href="https://github.com/c53hzn/april-cms" rel="nofollow noopener noreferrer" target="_blank">https://github.com/c53hzn/april-cms</a></p>
<p>Last year when I started to learn <code>Nuxt</code>, I read a lot about <code>Headless CMS</code>, it can be called a <code>CMS without front-end page design</code> according to my understanding. I studied some of these projects and methods to use them, and tried to use one myself, but did not make it to the end. I still wanted to build up my website without relying on these external services. Although for comment system and visitor counter I might still be using external services as long as I'm building static website.</p>
<p>Then I managed to write an <code>API</code> to serve as a <code>CMS</code>, you can refer to <a href="blog/nuxt-blog-static-website-en">this article</a>.</p>
<p>This <code>API</code> allows me to update my <code>Markdown</code> articles and use <code>Nuxt</code> to generate static page files, then I can push them to Github and update my website.</p>
<p>Usually I use <code>Sublime Text</code> to write codes, this editor can show working documents on the left, and it is easy to switch between files.</p>
<blockquote>
<p>But humans tend to go on a hard way.</p>
<p>by Me</p>
</blockquote>
<p>I want a <code>CMS</code> with an interface, and I can create/ modify/ read/ save/ delete in that interface. Also I  don't want a database, I just want to work on the <code>Markdown</code> files.</p>
<p>I think I can do it.</p>
<h2 id="what-i-need-for-backend"><a href="#what-i-need-for-backend" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What I need for backend</h2>
<p>I wrote my <code>API</code> with <code>express</code> framework under <code>Node</code> environment, and I still want to achieve more with the same structure, so there are a few methods that I need to master, like:</p>
<ol>
<li>Make the <code>API</code> to read static HTML page and return a <code>CMS</code> UI on the browser.</li>
<li>When the <code>API</code> is started, the browser will automatically be opened and go to the <code>CMS</code> control panel.</li>
<li>Make the <code>API</code> to receive data sent from browser(clients) and save on local computer.</li>
<li>Make the <code>API</code> to receive data sent from browser and delete related file.</li>
</ol>
<h2 id="what-i-need-for-front-end"><a href="#what-i-need-for-front-end" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>What I need for front-end</h2>
<p>I had a <a href="https://www.codepen.io" rel="nofollow noopener noreferrer" target="_blank">CodePen</a> project <a href="https://codepen.io/c53hzn/full/YzzRzxR" rel="nofollow noopener noreferrer" target="_blank">Markdown Previewer</a> that only has fewer than 5 visits in the last half year. It would be a shame to leave it there, and it might be better if I can use it here.</p>
<p>The CodePen project was rendered with <code>marked</code>, while my API was rendered with <code>markdown-it</code>. In order to consolidate my codes, I decided to change the renderer to <code>markdown-it</code>.</p>
<p>The project was written with <code>jQuery</code>, I decided to continue using <code>jQuery</code> for the front-end page interaction after some comparison.</p>
<p>Here are some issues that we need to solve:</p>
<ol>
<li>To read article list from <code>API</code> and render it in article list ares.</li>
<li>To read article contents from <code>API</code> and fill in title/ tags/ description/ related blogs/ main contents to relevant input box or textarea, and then the preview area</li>
<li>Every time there is a change in the <code>Markdown</code> editor, the preview area should be updated simultaneously, it also should have code highlight and normal HTML styles.</li>
<li>When <code>Save post</code> is clicked, the page should confirm is all input boxed are filled, if <code>No</code> then page will <code>alert</code> that user should fill in all blanks. If <code>Yes</code> then check if article already exists, if <code>Yes</code> then <code>confirm</code> if need to update post, if <code>No</code> then <code>confirm</code> if need to create new post.</li>
<li>When <code>Delete post</code> is clicked, the page should crosscheck if <code>slug</code> exists in post list, if <code>No</code> then <code>alert</code> that there is nothing to delete, if <code>Yes</code> then <code>confirm</code> if really need to delete.。</li>
<li>When <code>Ctrl+enter</code> is pressed on keyboard, <code>save</code> action should be triggered.</li>
<li>When creating or updating, the browser will use <code>post</code> method in <code>jQuery</code> to submit contents to server and receive result and reflect it to browser.</li>
<li>When deleting, the browser will use use <code>post</code> method in <code>jQuery</code> to submit the <code>slug</code> of the post to server, then receive result of deletion and reflect it to browser.</li>
</ol>
<p>All actions should be completed in the same page.</p>
<h2 id="actual-codes-for-backend"><a href="#actual-codes-for-backend" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Actual codes for backend</h2>
<h3 id="dependencies-for-api"><a href="#dependencies-for-api" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Dependencies for API</h3>
<p>First <code>require</code> all the dependencies and other required modules.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'front-matter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'highlight.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> yaml <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"yaml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownItToc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it-toc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> open <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">"\\config.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span>         <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 在源码中启用 HTML 标签</span>
  xhtmlOut<span class="token operator">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 使用 '/' 来闭合单标签 （比如 &lt;br />）。</span>
  breaks<span class="token operator">:</span>       <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 转换段落里的 '\n' 到 &lt;br>。</span>
  langPrefix<span class="token operator">:</span>   <span class="token string">'language-'</span><span class="token punctuation">,</span>  <span class="token comment">// 给围栏代码块的 CSS 语言前缀。对于额外的高亮代码非常有用。</span>
  linkify<span class="token operator">:</span>      <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 将类似 URL 的文本自动转换为链接。</span>
  typographer<span class="token operator">:</span>  <span class="token boolean">false</span><span class="token punctuation">,</span>
  quotes<span class="token operator">:</span> <span class="token string">'“”‘’'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">highlight</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>lang <span class="token operator">&&</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">getLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">highlight</span><span class="token punctuation">(</span>lang<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 使用额外的默认转义</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
md<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>markdownItToc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>The <code>config</code> here is an extra configuration file that I added, the contents inside it is simple:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    isSlugUseDate<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    blogPath<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'\\blog'</span><span class="token punctuation">,</span>
    imgPath<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'\\img\\blog'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div>
<p>This <code>config</code> is to control the <code>Markdown</code> file path and image file path, and also whether to use date when it comes to <code>slug</code>. If <code>slug</code> uses date, then it will be a long <code>slug</code>, like <code>2020-04-26-editor-for-my-cms-of-my-nuxt-blog-en</code>. If <code>slug</code> does not use date, then it will be a short <code>slug</code>, like <code>editor-for-my-cms-of-my-nuxt-blog-en</code>, and the real blog <code>URL</code> will also be changed with it.</p>
<h3 id="to-return-unrendered-markdown-when-called"><a href="#to-return-unrendered-markdown-when-called" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>To return unrendered Markdown when called</h3>
<p>First do some settings in the <code>API</code> entry point file <code>app.js</code>, this is to control whether to return <code>Markdown</code> or rendered <code>HTML</code> contents, and <code>API</code> will also return contents according to <code>slug</code> in request based on configuration.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">slugToFileName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">slug<span class="token punctuation">,</span>isSlugUseDate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSlugUseDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> slug<span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> tempSlug <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tempSlug <span class="token operator">==</span> slug<span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">fileNameToSlug</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span>isSlugUseDate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSlugUseDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> filename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>filename<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> filename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>filename<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">singleBlog</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fullPath<span class="token punctuation">,</span>slug<span class="token punctuation">,</span>isContentRequired<span class="token punctuation">,</span>isMD<span class="token punctuation">,</span>isDev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blog <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token function">fm</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blog <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token property-access">attributes</span><span class="token punctuation">;</span>
  blog<span class="token punctuation">.</span><span class="token property-access">slug</span> <span class="token operator">=</span> slug<span class="token punctuation">;</span>
  <span class="token keyword">var</span> fullFilename <span class="token operator">=</span> fullPath<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blog<span class="token punctuation">.</span><span class="token property-access">date</span> <span class="token operator">=</span> fullFilename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isContentRequired <span class="token operator">&&</span> <span class="token operator">!</span>isMD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'@[toc]( )\n'</span> <span class="token operator">+</span> content<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//if isDev then use absolute path for images</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isDev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">src=<span class="token escape">\"</span><span class="token group punctuation">(</span><span class="token escape">\/</span><span class="token group punctuation">)</span><span class="token quantifier number">?</span>img</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"src=\"http://127.0.0.1:4000/img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// add class "hljs" for dark theme rendering</span>
    blog<span class="token punctuation">.</span><span class="token property-access">content</span> <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token escape">\&lt;</span>pre</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"&lt;pre class='hljs'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isContentRequired <span class="token operator">&&</span> isMD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    blog<span class="token punctuation">.</span><span class="token property-access">content</span> <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> blog<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//return blog related contents</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/blog"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// allow cross orign access</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> blogPath <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> imgPath <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">imgPath</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>blogPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// result to be returned</span>
  <span class="token keyword">var</span> qSlug <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">slug</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qTag <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">tag</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qImg <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qIsMD <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">ismd</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qIsDev <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">isdev</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> isSlugUseDate <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">iseditor</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token boolean">true</span><span class="token operator">:</span>config<span class="token punctuation">.</span><span class="token property-access">isSlugUseDate</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qSlug<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with blog slug query</span>
    json <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blogPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">slugToFileName</span><span class="token punctuation">(</span>qSlug<span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>qSlug<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>qIsMD<span class="token punctuation">,</span>qIsDev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// add prev and next blog</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qSlug <span class="token operator">==</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">next</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">prev</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">prev</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
          json<span class="token punctuation">.</span><span class="token property-access">next</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qTag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with tag query</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qTag <span class="token operator">==</span> <span class="token string">"all_tags"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// returns list of all available tags</span>
      json<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tags <span class="token operator">=</span> blogPost<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token string">'none'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span>
          slug<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">slug</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span><span class="token comment">// returns blog list of specific tag</span>
      json<span class="token punctuation">.</span><span class="token property-access">blogs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tags <span class="token operator">=</span> blogPost<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token string">'none'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span>
          slug<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">slug</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> qTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">blogs</span><span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>blogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qImg<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with img query</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qImg <span class="token operator">==</span> <span class="token string">"all_imgs"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      json<span class="token punctuation">.</span><span class="token property-access">imgs</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> imgFolders <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgFolders<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> imgs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>imgPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>imgFolders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token property-access">imgs</span><span class="token punctuation">[</span>imgFolders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> imgs<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span><span class="token comment">//without requirement, returns list of all blogs</span>
    json<span class="token punctuation">.</span><span class="token property-access">blogs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      json<span class="token punctuation">.</span><span class="token property-access">blogs</span><span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>blogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/config"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// allow cross orign access</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="add-backend-ui-for-api"><a href="#add-backend-ui-for-api" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Add Backend UI for API</h3>
<p>The entry point for Backend UI is <code>app.html</code>, and in order to access the static page <code>app.html</code>, you need codes below:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-text"><code>//return blog content editor page
app.use(express.static(__dirname));
app.get("/", function(req, res) {
    // allow cross orign access
  res.header('Access-Control-Allow-Origin', '*');
  res.sendFile(__dirname+"\\app.html");
});
/* nuxt is using port 3000, so choose another one */
app.listen(4000, () => {
  console.log("express server running at http://127.0.0.1:4000")
});
</code></pre></div>
<p>Then the entry link for the <code>CMS</code> should be <code>http://127.0.0.1:4000/</code>.</p>
<p>In order to start <code>API</code> and open browser to access this page, you will need an <code>npm</code> called <code>open</code>. Just write one line of command.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"http:127.0.0.1:4000/"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>app<span class="token operator">:</span> <span class="token string">"chrome.exe"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>This will open browser and go to <code>CMS</code> control panel. There is only one page for the control panel, so it's easy to manage.</p>
<h3 id="to-save-and-delete-file"><a href="#to-save-and-delete-file" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>To save and delete file</h3>
<p>Then there is the need for receiving data from browser and save it to local computer, or receiving data from browser and delete relevant file.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token comment">//api to submit post</span>
<span class="token comment">// Parse URL-encoded bodies (as sent by HTML forms)</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Parse JSON bodies (as sent by API clients)</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Access the parse results as request.body</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/savepost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileName <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">writeFileSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token property-access">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Client will get status of failure w/o this</span>
    <span class="token comment">//even if data is saved to server successfully</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// delete post</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/deletepost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileName <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">unlinkSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//file removed</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token comment">//Client will get status of failure w/o this</span>
    <span class="token comment">//even if data is saved to server successfully</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="actual-codes-for-front-end"><a href="#actual-codes-for-front-end" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Actual codes for front-end</h2>
<h3 id="to-call-api-and-markdown"><a href="#to-call-api-and-markdown" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>To call API and Markdown</h3>
<p>There is not much to say about the full codes. To get post list, you can call <code>/blogs</code> with <code>jQuery</code>'s <code>getJSON</code> method, and to save post you can call <code>/savepost</code>, and to delete post you can call <code>/deletepost</code>, both with <code>post</code> method in <code>jQuery</code>.</p>
<p>You can get <code>Markdown</code> contents from the editor in UI and use <code>markdown-it</code> to render to the preview area, also don't forget the <code>highlight.js</code> and <code>markdown-it-toc</code> plugins, then import <code>github-markdown</code>
and the <code>css</code> for <code>highlight.js</code> to render the converted <code>HTML</code>, it's almost done.</p>
<h3 id="points-to-notice-when-rendering-markdown"><a href="#points-to-notice-when-rendering-markdown" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Points to notice when rendering Markdown</h3>
<p>Here you might want to take a look at the usage for those <code>Node</code> when applying them to browser.</p>
<p>When it was just <code>Node</code> script, first you <code>require</code> them.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'highlight.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownItToc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it-toc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Then you configure them.</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span>         <span class="token boolean">false</span><span class="token punctuation">,</span>
  xhtmlOut<span class="token operator">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>
  breaks<span class="token operator">:</span>       <span class="token boolean">false</span><span class="token punctuation">,</span>
  langPrefix<span class="token operator">:</span>   <span class="token string">'language-'</span><span class="token punctuation">,</span>
  linkify<span class="token operator">:</span>      <span class="token boolean">false</span><span class="token punctuation">,</span>
  typographer<span class="token operator">:</span>  <span class="token boolean">false</span><span class="token punctuation">,</span>
  quotes<span class="token operator">:</span> <span class="token string">'“”‘’'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">highlight</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>lang <span class="token operator">&&</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">getLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">highlight</span><span class="token punctuation">(</span>lang<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
md<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>markdownItToc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>Now you can use it to render <code>Markdown</code>.</p>
<p>But when I used the same settings for browser, there is always error saying this or that object is not found.</p>
<p>Then I discovered that the variables exposed by original authors have different casing comparing to my settings.</p>
<p>I opened those <code>.js</code> files and check the variables one by one and found that <code>markdown-it</code> used <code>markdownit</code> as global variable, and <code>markdown-it-toc</code>, the plugin that I used for generating anchor links, used <code>markdownitTOC</code> as global variable. After changing my settings, the script is finally OK to run</p>
<p>This should not have been a problem, I'm really upset about it.</p>
<h3 id="add-smooth-scrolling-effect"><a href="#add-smooth-scrolling-effect" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Add smooth scrolling effect</h3>
<p>I added anchor links for preview area, and I want those <code>#</code> links will not direct the page to those internal links, but rather have the page scroll to relevant position smoothly, here are the codes:</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">function</span> <span class="token function">updatePreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#editor"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">"\t"</span> <span class="token operator">+</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'[toc]\n'</span> <span class="token operator">+</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token escape">\&lt;</span>a</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"&lt;a target='_blank'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#preview"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//add scrollIntoView to anchor link</span>
  <span class="token keyword">var</span> aTags <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"a[href]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> aTags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> e <span class="token operator">||</span> event<span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> href <span class="token operator">=</span> aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> hashPos <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> id <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span>hashPos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> href<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d<span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">"a[id='"</span><span class="token operator">+</span><span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"']"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>behavior<span class="token operator">:</span> <span class="token string">"smooth"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="here-is-what-it-looks-like"><a href="#here-is-what-it-looks-like" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Here is what it looks like</h2>
<p>When you need to access this <code>API</code>, you can <code>cd</code> to that folder and</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-text"><code>node index.js
</code></pre></div>
<p>Then browser will open itself and be directed to <code>http://127.0.0.1:4000/</code>, you will be able to see post list, and be able to create/delete/modify articles, see the capture below</p>
<p><img alt="preview" src="/img/blog/2020-04-19/001.png"></p>
<h2 id="experience-from-this"><a href="#experience-from-this" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>Experience from this</h2>
<p>I finished what I started a year ago, and it only took me one day, I'm really happy about it.</p>
<p>If I am to give a name to this CMS, I think I will call it <code>April CMS</code>, because I finished it in April.</p>
<p>After finishing it, I did some study and think that, this <code>CMS</code> fits both descriptions of <code>API-based Headless CMS</code> and <code>Flat File CMS</code>, which is <code>a CMS that operates on text files rather than databases</code>. Seems good!</p>
<p>And the preview area and post list area will update themselves as you input and save or delete post, it will be really smooth when you write with it, maybe it can be used for writing documents or stories.</p>
<p>Don't know what more compliments can I say about it :)</p>
<p>On top of it, this <code>CMS</code> is a useful thing, and I hope I can create more useful stuff in the future.</p></div></article> <div class="prev-next"><a href="/blog/editor-for-my-cms-of-my-nuxt-blog" title="给Nuxt使用的基于API的CMS——还有管理后台呢" class="no-decor-link"><div class="prev"><p>Previous:<br> <span class="title">给Nuxt使用的基于API的CMS——还有管理后台呢</span></p></div></a> <a href="/blog/enable-spellcheck-on-chrome-en" title="How to enable spell check on Chrome" class="no-decor-link"><div class="next"><p>Next:<br> <span class="title">How to enable spell check on Chrome</span></p></div></a></div> <p> </p> <h3 class="align-center" style="margin-bottom:0"><span>You may also like</span></h3> <div class="pic-showcase" style="margin-top:0"><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/0ea1e7/2912468073/il_340x340.2912468073_8grx.jpg)"><div class="pic-showcase-unit-tag">USD 10.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/956233793" title="eBay template builder tool | listing item detail page description HTML generator | mobile responsive | no active content | instant download" target="_blank"><span class="title">eBay template builder tool | listing item detail page description HTML generator | mobile responsive | no active content | instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/002b6c/2881264109/il_340x340.2881264109_qo8o.jpg)"><div class="pic-showcase-unit-tag">USD 1.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/952862667" title="2021 Pocket mini Calendar 8 page foldable printable A7 size DIY zine style A4 paper PDF format instant download" target="_blank"><span class="title">2021 Pocket mini Calendar 8 page foldable printable A7 size DIY zine style A4 paper PDF format instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/7a7880/2863101521/il_340x340.2863101521_88kc.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/939707561" title="2021 weekly schedule planner | 10 types simple to-do list checklist calendar | printable A4 PDF editable excel template instant download" target="_blank"><span class="title">2021 weekly schedule planner | 10 types simple to-do list checklist calendar | printable A4 PDF editable excel template instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/c0ac13/2861084883/il_340x340.2861084883_qz8s.jpg)"><div class="pic-showcase-unit-tag">USD 1.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/925324268" title="100 day challenge planner | simple calendar | goal progress tracker | schedule A4 printable PDF excel template download" target="_blank"><span class="title">100 day challenge planner | simple calendar | goal progress tracker | schedule A4 printable PDF excel template download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/42e083/2864671639/il_340x340.2864671639_1v9f.jpg)"><div class="pic-showcase-unit-tag">USD 3.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/934477940" title="2021 monthly calendar planner | elegant water blue theme simple | A4 printable PDF instant digital download" target="_blank"><span class="title">2021 monthly calendar planner | elegant water blue theme simple | A4 printable PDF instant digital download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/6691ba/2815904808/il_340x340.2815904808_qn87.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/928907974" title="2021 income expense track | annual monthly daily expenditure | bill spending tracker | personal financial statement | excel template" target="_blank"><span class="title">2021 income expense track | annual monthly daily expenditure | bill spending tracker | personal financial statement | excel template</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/54d699/2881129977/il_340x340.2881129977_n9ly.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/939749315" title="multi year annual calendar | editable 2021 to 2030 selection excel template | three column | printable PDF xlsx instant download" target="_blank"><span class="title">multi year annual calendar | editable 2021 to 2030 selection excel template | three column | printable PDF xlsx instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/f95279/2863789693/il_340x340.2863789693_47rx.jpg)"><div class="pic-showcase-unit-tag">USD 3.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="https://www.etsy.com/listing/939397411" title="2021 monthly calendar weekly schedule planner | multi year 8-color simple calendar | printable PDF with editable excel template download" target="_blank"><span class="title">2021 monthly calendar weekly schedule planner | multi year 8-color simple calendar | printable PDF with editable excel template download</span></a> <!----></div> <!----></div></div></div> <p> </p> <div><h3 class="align-center"><span style="border-bottom:2px solid #000">Related Posts</span></h3> <div class="blog-gallery"><div class="blog-gallery-unit"><a href="/blog/editor-for-my-cms-of-my-nuxt-blog" title="April CMS，一个兼具Headless CMS和Flat File CMS的特征的操作文本文件的基于API提供内容的CMS，很实用的一个项目哦~" class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>给Nuxt使用的基于API的CMS——还有管理后台呢</h4> <p><span class="blog-date"><i class="fa fa-calendar"></i>
               2020-04-19
            </span> <span class="blog-gallery-lang">
              中文
            </span></p> <p class="align-left"><span class="blog-gallery-desc">April CMS，一个兼具Headless CMS和Flat File CMS的特征的操作文本文件的基于API提供内容的CMS，很实用的一个项目哦~</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                我的项目
              </span><span class="blog-gallery-tag">
                JavaScript
              </span><span class="blog-gallery-tag">
                Node.js
              </span><span class="blog-gallery-tag">
                jQuery
              </span><span class="blog-gallery-tag">
                技术
              </span></span></p></div></a></div><div class="blog-gallery-unit"><a href="/blog/nuxt-blog-static-website-en" title="I built up my website with Nuxt. First I created an API to parse Markdown articles and return JSON contents, and then used Nuxt+Axios to call this API to retrieve blog article and generate static pages based on this structure. Here you can see some details." class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>How to build up a static blog website with Nuxt</h4> <p><span class="blog-date"><i class="fa fa-calendar"></i>
               2020-04-05
            </span> <span class="blog-gallery-lang">
              English
            </span></p> <p class="align-left"><span class="blog-gallery-desc">I built up my website with Nuxt. First I created an API to parse Markdown articles and return JSON contents, and then used Nuxt+Axios to call this API to retrieve blog article and generate static pages based on this structure. Here you can see some details.</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                JavaScript
              </span><span class="blog-gallery-tag">
                Node.js
              </span><span class="blog-gallery-tag">
                Nuxt.js
              </span><span class="blog-gallery-tag">
                Static Blog
              </span><span class="blog-gallery-tag">
                Tech
              </span></span></p></div></a></div></div></div> <div id="comment"></div></section></div></main> <footer><p>Created with Nuxt.js <br>
    	Designed by  
    	<a href="https://github.com/c53hzn" target="_blank" class="no-decor-link"><strong>Jenny HOU</strong> <i class="fa fa-github font-20"></i></a></p> <div class="go-top go-top-hidden"><div class="arrow"></div> <div class="stick"></div></div></footer></div></div></div><script defer src="/_nuxt/static/1613379781/blog/editor-for-my-cms-of-my-nuxt-blog-en/state.js"></script><script src="/_nuxt/e5fa922.js" defer></script><script src="/_nuxt/525861d.js" defer></script><script src="/_nuxt/bb5f8ec.js" defer></script><script src="/_nuxt/e4d6bd6.js" defer></script><script src="/_nuxt/092fd27.js" defer></script>
  </body>
</html>
