<!doctype html>
<html data-n-head-ssr>
  <head>
    <title>给Nuxt使用的基于API的CMS——还有管理后台呢 | Jenny的小站</title><meta data-n-head="ssr" charset="utf-8"><meta data-n-head="ssr" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="ssr" data-hid="date" name="date" content="2020-04-19"><meta data-n-head="ssr" data-hid="description" name="description" content="April CMS，一个兼具Headless CMS和Flat File CMS的特征的操作文本文件的基于API提供内容的CMS，很实用的一个项目哦~"><meta data-n-head="ssr" data-hid="keyword" name="keyword" content="我的项目,JavaScript,Node.js,jQuery,技术"><base href="/"><link data-n-head="ssr" rel="shortcut icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="ssr" rel="stylesheet" href="/css/font-gugi.css"><link data-n-head="ssr" rel="stylesheet" href="/css/font-poppins.css"><link data-n-head="ssr" rel="stylesheet" href="/css/style.css?2021-02-21"><link data-n-head="ssr" rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><script data-n-head="ssr" src="/js/statcounter.js?2021-03-07-1"></script><link rel="preload" href="/_nuxt/2a7fd5a.js" as="script"><link rel="preload" href="/_nuxt/6280bdd.js" as="script"><link rel="preload" href="/_nuxt/fe0f673.js" as="script"><link rel="preload" href="/_nuxt/f975ada.js" as="script"><link rel="preload" href="/_nuxt/22b5e3c.js" as="script"><style data-vue-ssr-id="89dfa84c:0 019e1cef:0 779bf73e:0 72520070:0 1da8fc0f:0 f28bdea2:0">code[class*=language-],pre[class*=language-]{color:#d4d4d4;font-size:13px;text-shadow:none;font-family:Menlo,Monaco,Consolas,"Andale Mono","Ubuntu Mono","Courier New",monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#75a7ca}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#75a7ca}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;background:#1e1e1e}:not(pre)>code[class*=language-]{padding:.1em .3em;border-radius:.3em;color:#db4c69;background:#f9f2f4}.namespace{opacity:.7}.token.doctype .token.doctype-tag{color:#569cd6}.token.doctype .token.name{color:#9cdcfe}.token.comment,.token.prolog{color:#6a9955}.language-html .language-css .token.punctuation,.language-html .language-javascript .token.punctuation,.token.punctuation{color:#d4d4d4}.token.boolean,.token.constant,.token.inserted,.token.number,.token.property,.token.symbol,.token.tag,.token.unit{color:#b5cea8}.token.attr-name,.token.builtin,.token.char,.token.deleted,.token.selector,.token.string{color:#ce9178}.language-css .token.string.url{text-decoration:underline}.token.entity,.token.operator{color:#d4d4d4}.token.operator.arrow{color:#569cd6}.token.atrule{color:#ce9178}.token.atrule .token.rule{color:#c586c0}.token.atrule .token.url{color:#9cdcfe}.token.atrule .token.url .token.function{color:#dcdcaa}.token.atrule .token.url .token.punctuation{color:#d4d4d4}.token.keyword{color:#569cd6}.token.keyword.control-flow,.token.keyword.module{color:#c586c0}.token.function,.token.function .token.maybe-class-name{color:#dcdcaa}.token.regex{color:#d16969}.token.important{color:#569cd6}.token.italic{font-style:italic}.token.constant{color:#9cdcfe}.token.class-name,.token.maybe-class-name{color:#4ec9b0}.token.console,.token.interpolation,.token.parameter{color:#9cdcfe}.token.boolean,.token.punctuation.interpolation-punctuation{color:#569cd6}.token.exports .token.maybe-class-name,.token.imports .token.maybe-class-name,.token.property,.token.variable{color:#9cdcfe}.token.escape,.token.selector{color:#d7ba7d}.token.tag{color:#569cd6}.token.cdata,.token.tag .token.punctuation{color:grey}.token.attr-name{color:#9cdcfe}.token.attr-value,.token.attr-value .token.punctuation{color:#ce9178}.token.attr-value .token.punctuation.attr-equals{color:#d4d4d4}.token.entity{color:#569cd6}.token.namespace{color:#4ec9b0}code[class*=language-javascript],code[class*=language-jsx],code[class*=language-tsx],code[class*=language-typescript],pre[class*=language-javascript],pre[class*=language-jsx],pre[class*=language-tsx],pre[class*=language-typescript]{color:#9cdcfe}code[class*=language-css],pre[class*=language-css]{color:#ce9178}code[class*=language-html],pre[class*=language-html]{color:#d4d4d4}.language-regex .token.anchor{color:#dcdcaa}.language-html .token.punctuation{color:grey}pre[data-line]{position:relative}pre[class*=language-]>code[class*=language-]{position:relative;z-index:1}.line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:#f7ebc6;box-shadow:inset 5px 0 0 #f7d87c;z-index:0;pointer-events:none;line-height:inherit;white-space:pre}.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.breadcrumbs{margin:0 auto;padding:10px 0 0;width:1080px}.breadcrumbs a,.breadcrumbs a:visited{text-decoration:none;color:#000;font-weight:700}.breadcrumbs a:hover{color:grey}@media (max-width:1080px){.breadcrumbs{padding-left:10px;background:#fff;width:auto}}.nuxt-content{margin-bottom:50px}.nuxt-content h2{margin:9px 18px;padding:9px 0}.nuxt-content h3,.nuxt-content h4,.nuxt-content h5{margin:0 18px;padding:0}.nuxt-content h2,.nuxt-content h3{border-bottom:1px solid silver}.nuxt-content h2{font-size:30px}.nuxt-content h3{font-size:28px}.nuxt-content h4{font-size:24px}.nuxt-content h5{font-size:20px}.nuxt-content p{margin-left:18px;margin-right:18px;line-height:24px}.nuxt-content ol{padding-right:18px}.nuxt-content li{line-height:24px}.nuxt-content li p{margin:0}.nuxt-content iframe{margin:8px auto 8px 20px;width:400px;height:300px;display:block}.nuxt-content blockquote{margin:16px 18px;padding:10px;color:#6a737d;background-color:#f8f8f8;border-left:.25em solid #dfe2e5}.nuxt-content img{max-height:100px;max-width:600px;border:1px solid silver}.nuxt-content pre{margin-left:18px;margin-right:18px;border-radius:4px}.nuxt-content code,.nuxt-content li p code{padding:4px;color:#d4d4d4;vertical-align:top;background:#1e1e1e;border-radius:4px;display:inline}.nuxt-content a,.toc a,.toc a:active,.toc a:visited{color:#000;font-weight:700}.nuxt-content a:hover,.toc a:hover{color:grey}li.toc3{list-style:circle;margin-left:15px}a[id]{position:relative;top:-40px;display:block}a#comment-link{top:0}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}#disqus_thread{margin-top:20px}.prev-next{margin:20px auto;display:block}.prev-next:after{display:table;content:" ";clear:both}.prev-next a{display:inline}.next,.prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:20px auto;width:100%;color:grey;border:1px solid grey;cursor:pointer}.prev{margin-left:18px;width:46%;text-align:left;float:left}.next{margin-right:18px;width:46%;text-align:right;float:right}.next:hover,.prev:hover{color:#000;border-color:#000}.next p,.prev p{margin:14px;padding:0;height:46px;overflow:hidden}#comment{margin:40px 18px 0}@media (max-width:768px){.nuxt-content h2,.nuxt-content h3,.nuxt-content h4,.nuxt-content h5{margin:9px 0}.nuxt-content blockquote{margin:16px 0}.nuxt-content img{max-width:100%}.nuxt-content p{margin-left:0;margin-right:0}.nuxt-content iframe{margin:8px auto;width:100%}.nuxt-content ul{padding-left:20px}.nuxt-content pre{margin-left:0;margin-right:0}.next,.prev{margin:0}.next p,.prev p{margin:8px;padding:0}.next .title,.prev .title{font-size:12px}#comment{margin:40px 0 0}}@media (max-width:539px){.nuxt-content iframe{height:auto}}.pic-showcase{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.pic-showcase-unit-2,.pic-showcase-unit-3{position:relative;margin:20px;border:1px solid silver;border-radius:5px;overflow:hidden}.pic-showcase-unit-2{width:45%}.pic-showcase-unit-3{width:29%}.pic-showcase-unit-4{position:relative;margin:20px 10px 0;width:22%;border:1px solid silver;border-radius:5px;overflow:hidden}.pic-showcase-bg{width:100%;background:no-repeat top;background-size:cover;border:2px solid #fff;border-radius:6px}.rectangle-bottom{border-bottom-left-radius:0;border-bottom-right-radius:0}.pic-showcase-unit-tag{position:absolute;left:5px;bottom:5px;padding:2px 8px;font-size:12px;background:#e1e1e1;border:1px solid hsla(0,0%,50.2%,.3);border-radius:16px}.pic-showcase-text-left{left:0;bottom:0;width:100%;height:100%;display:table-cell;vertical-align:middle;color:#fff;background:rgba(0,0,0,.7);transform:translateX(-100%);transition:transform .5s;justify-content:center;display:flex}.pic-showcase-text-left div{position:absolute;top:50%;left:50%;width:90%;transform:translate(-50%,-50%)}.pic-showcase-text-bottom{position:absolute;left:0;bottom:0;width:100%;color:#fff;background:rgba(0,0,0,.7);transform:translateY(100%);transition:transform .5s}.pic-showcase-text-below{left:0;bottom:0;width:100%;height:50%}.pic-showcase-unit-2 .pic-showcase-text-bottom{height:50%;display:table}.pic-showcase-unit-2 .pic-showcase-text-bottom div{padding:20px;display:table-cell;vertical-align:middle}.pic-showcase-unit-2:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-2:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-unit-3:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-3:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-unit-4:hover>.pic-showcase-text-left{transform:translateX(0)}.pic-showcase-unit-4:hover>.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-title{margin:0 5px;padding:16px 0;text-align:center}.pic-showcase-title span.title{font-weight:700}.h-auto .pic-showcase-title{padding:8px 0 10px}.h-auto .pic-showcase-title span.title{max-height:108px;display:block;overflow:hidden}.pic-showcase-unit-4.h-auto .pic-showcase-title span.title{font-size:16px;font-weight:400;line-height:18px;max-height:92px}.h-200{height:200px}.h-300{height:300px}.h-400{height:400px}.h-500{height:500px}.h-full{height:100%}.h-half{height:50%}.h-auto{height:auto}.pos-relative{position:relative}.pos-absolute{position:absolute}@media (max-width:1024px){.pic-showcase-unit-2{margin:0 10px 20px}.pic-showcase-text-bottom{transform:translateY(0)}.pic-showcase-text-left{transform:translateX(0);position:relative}}@media (max-width:768px){.h-300,.pic-showcase-unit-2,.pic-showcase-unit-4{height:200px}.pic-showcase-unit-2{width:44%}.pic-showcase-unit-3{margin:0 10px 10px;width:45%}.h-auto{height:auto}.h-auto .h-200{height:140px}.pic-showcase-unit-4{width:22%}}@media (max-width:539px){.pic-showcase-unit-2{margin:0 5px 10px;width:100%}.pic-showcase-unit-3{margin:0 5px 10px;width:47%}.pic-showcase-unit-4{margin-left:5px;margin-right:5px;width:46%}.mobile-hidden{display:none}}@media (max-width:425px){.pic-showcase-unit-3{width:48%}}.blog-gallery{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.blog-gallery-unit{margin:40px 20px 0;width:46%;border:1px solid silver;border-radius:5px}.blog-gallery-unit:first-child,.blog-gallery-unit:nth-child(2){margin-top:20px}.blog-gallery-unit:nth-child(2n-1){margin-left:0}.blog-gallery-unit:nth-child(2n){margin-right:0}.blog-gallery-unit:hover{border-color:#000}.blog-gallery-inner{padding:21px 10px 10px;height:100%}.blog-gallery-inner h4{margin-top:0;max-height:42px;overflow:hidden}.blog-gallery-desc{line-height:21px;max-height:64px;display:block;overflow:hidden}.blog-gallery-tag{margin:1px;padding:0 8px;color:#fff;font-size:12px;font-family:"Microsoft Yahei";line-height:20px;border-radius:999px;background:grey;display:inline-block}.blog-gallery-lang{display:inline-block;width:60px;font-size:14px;text-align:center;color:grey;border:1px solid silver;border-radius:4px}@media (max-width:768px){.blog-gallery-unit:nth-child(2n-1){margin-right:15px}.blog-gallery-unit:nth-child(2n){margin-left:15px}}@media (max-width:425px){.blog-gallery-unit{margin:20px 0 0;width:100%}.blog-gallery-unit:nth-child(2n-1){margin-right:0}.blog-gallery-unit:nth-child(2n){margin-left:0}}</style><link rel="preload" href="/_nuxt/static/1615117240/blog/editor-for-my-cms-of-my-nuxt-blog/state.js" as="script"><link rel="preload" href="/_nuxt/static/1615117240/blog/editor-for-my-cms-of-my-nuxt-blog/payload.js" as="script"><link rel="preload" href="/_nuxt/static/1615117240/manifest.js" as="script">
  </head>
  <body>
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav><div class="nav-wrap"><header><a href="/" class="no-decor-link"><p class="nav-home">Jenny's blog</p></a></header> <div class="nav-btn"><div class="bar"></div> <div class="bar"></div> <div class="bar"></div> <div class="bar"></div></div> <div class="nav-mask"></div> <div class="body-mask"></div> <ul class="nav-ul"><span title="将UI文本切换成中文" class="nav-link" style="padding-left:10px">
      中文
    </span> <a href="/" target="_self" class="nav-link"><li>Home<!----><!----></li></a><a href="/resume" target="_self" class="nav-link"><li>Resume<!----><!----></li></a><a href="/portfolio" target="_self" class="nav-link"><li>Portfolio<!----><!----></li></a><a href="/blog" target="_self" class="nav-link nuxt-link-active"><li>Blog<!----><!----></li></a><a href="/store" target="_self" class="nav-link"><li>Store<!----><!----></li></a><a href="https://wj.qq.com/s2/3731207/f0cd/" target="_blank" class="nav-link"><li>Contact<span> </span><i class="fa fa-external-link"></i></li></a></ul></div></nav> <main><div class="breadcrumbs"><span><a href="/">Home</a><!----><span> / </span></span><span><a href="/blog">Blog</a><!----><span> / </span></span><span><!----><span>editor-for-my-cms-of-my-nuxt-blog</span><!----></span></div> <div><section class="main-content"><h1 class="align-center article-title">给Nuxt使用的基于API的CMS——还有管理后台呢</h1> <p class="align-center"><span class="blog-date"><i class="fa fa-calendar"></i>
        2020-04-19
      </span> <a href="/blog/language/中文"><span class="blog-lang">中文</span></a> <span style="font-size:14px;color:gray">
        48 min read
      </span></p> <p class="blog-tags align-center"><a href="/blog/tag/我的项目"><span class="blog-tag">我的项目</span></a><a href="/blog/tag/JavaScript"><span class="blog-tag">JavaScript</span></a><a href="/blog/tag/Node.js"><span class="blog-tag">Node.js</span></a><a href="/blog/tag/jQuery"><span class="blog-tag">jQuery</span></a><a href="/blog/tag/技术"><span class="blog-tag">技术</span></a></p> <div class="blog-desc">April CMS，一个兼具Headless CMS和Flat File CMS的特征的操作文本文件的基于API提供内容的CMS，很实用的一个项目哦~</div> <article><ul class="toc"><li class="toc2"><a href="#一个真正的cms">一个真正的CMS</a></li><li class="toc2"><a href="#后端需要实现的效果">后端需要实现的效果</a></li><li class="toc2"><a href="#前端需要实现的效果">前端需要实现的效果</a></li><li class="toc2"><a href="#后端的实际写法">后端的实际写法</a></li><li class="toc3"><a href="#api-使用的依赖包">API 使用的依赖包</a></li><li class="toc3"><a href="#api-被调用时返回处理后的-html-或原-markdown-内容">API 被调用时返回处理后的 HTML 或原 Markdown 内容</a></li><li class="toc3"><a href="#给-api-添加管理后台入口">给 API 添加管理后台入口</a></li><li class="toc3"><a href="#保存文件和删除文件">保存文件和删除文件</a></li><li class="toc2"><a href="#前端的实际写法">前端的实际写法</a></li><li class="toc3"><a href="#调用-api-和渲染-markdown">调用 API 和渲染 Markdown</a></li><li class="toc3"><a href="#渲染-markdown-时的注意事项">渲染 Markdown 时的注意事项</a></li><li class="toc3"><a href="#添加页内平滑滚动效果">添加页内平滑滚动效果</a></li><li class="toc2"><a href="#大概是这么个效果">大概是这么个效果</a></li><li class="toc2"><a href="#心得体会">心得体会</a></li></ul> <div class="nuxt-content"><h2 id="一个真正的cms"><a href="#%E4%B8%80%E4%B8%AA%E7%9C%9F%E6%AD%A3%E7%9A%84cms" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>一个真正的CMS</h2>
<p>GitHub 项目地址： <a href="https://github.com/c53hzn/april-cms" rel="nofollow noopener noreferrer" target="_blank">https://github.com/c53hzn/april-cms</a></p>
<p>去年开始学习使用 <code>Nuxt</code> 的时候，看了很多关于 <code>Headless CMS</code> 的介绍，按我的理解，就是 <code>不带前端页面设计的内容管理系统</code> ，研究了一下这类的项目以及相关使用方法，自己也尝试使用了一下，但是没有坚持到底，还是想不依赖这些外部服务来构建自己的网站。不过评论系统和访客统计还是得用外部服务，因为静态网站服务器做不到这些。</p>
<p>后来我自己写出了可以用作 <code>CMS</code> 的 <code>API</code>，可以参见 <a href="/blog/nuxt-blog-static-website">如何使用Nuxt建立个人博客</a>。</p>
<p>这个 <code>API</code> 让我可以只需更新 <code>Markdown</code> 文章，再使用 <code>Nuxt</code> 的生成静态页面的功能就可以更新我的网站。通常我是用 <code>Sublime Text</code> 这个编辑器来编写代码的，它可以在左边显示工程文件，切换起来也挺方便的。</p>
<blockquote>
<p>可是人类就是喜欢自找麻烦。</p>
<p>by 我</p>
</blockquote>
<p>我想要一个有界面的 <code>CMS</code>，能新建，能修改，能读取，能保存，能删除。但是我只要操作 <code>Markdown</code> 文件，而不要任何数据库。</p>
<p>我觉得我能做到。</p>
<p>写了个英文版 <a href="/blog/editor-for-my-cms-of-my-nuxt-blog-en">Write a control panel for my API-based CMS for Nuxt</a>，大家随便看看就好。</p>
<h2 id="后端需要实现的效果"><a href="#%E5%90%8E%E7%AB%AF%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%88%E6%9E%9C" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>后端需要实现的效果</h2>
<p>由于我原本的 <code>API</code> 是用 <code>Node</code> 的 <code>express</code> 写的，所以还是想在此基础上继续精进，那么就需要掌握 <code>Node</code> 服务器的一些用法，比如：</p>
<ol>
<li>让 <code>API</code> 读取静态 HTML 页面，使浏览器能显示 <code>CMS</code> 的 UI 界面。</li>
<li>开启 <code>API</code> 的时候自动打开浏览器访问入口，也就是前一项的 UI 界面。</li>
<li>让 <code>API</code> 能接受浏览器（客户端）传回来的数据，并保存到本地。</li>
<li>让 <code>API</code> 接受浏览器传回来的数据，然后删除相关文件。</li>
</ol>
<h2 id="前端需要实现的效果"><a href="#%E5%89%8D%E7%AB%AF%E9%9C%80%E8%A6%81%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%95%88%E6%9E%9C" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>前端需要实现的效果</h2>
<p>我之前还有一个在 <a href="https://www.codepen.io" rel="nofollow noopener noreferrer" target="_blank">CodePen</a> 上的 <a href="https://codepen.io/c53hzn/full/YzzRzxR" rel="nofollow noopener noreferrer" target="_blank">Markdown Previewer</a> 的项目，半年来浏览量一只手就能数得清，就这么放着也挺可惜，不如拿来这里用一用。</p>
<p>CodePen 项目的渲染效果是用 <code>marked</code> 来实现的的，而我的 <code>API</code> 里面是用 <code>markdown-it</code> 来做渲染的，为了统一写法，得把渲染的方式改成 <code>Markdown-it</code>。</p>
<p>这个项目主体是用 <code>jQuery</code> 写的，我最终决定继续用 <code>jQuery</code> 来写前端的页面交互。</p>
<p>那么我们就需要解决以下的问题：</p>
<ol>
<li>读取 <code>API</code> 传来的文章列表并渲染到文章列表区</li>
<li>读取 <code>API</code> 传来的文章内容并渲染文章的标题、标签、描述、关联文章、正文到各个输入框，以及最重要的 <code>Markdown</code> 编辑器</li>
<li>每当 <code>Markdown</code> 编辑器有更新时，预览区也要跟着更新，预览区还应该有代码高亮和一般样式渲染</li>
<li>点击 <code>Save post</code> 的时候，页面要检查各个输入框是否都有内容，没有则 <code>alert</code> 让填写内容，有的话再检查文章是否已存在，存在则 <code>confirm</code> 要不要更新，不存在则 <code>confirm</code> 要不要创建。</li>
<li>点击 <code>Delete post</code> 的时候，页面要检查 <code>slug</code> 在文章列表里是否存在，不存在则 <code>alert</code> 说没东西可删，如果存在则要 <code>confirm</code> 是否真的删除。</li>
<li>键盘按下 <code>ctrl+enter</code> 触发保存，效果等同于点击 <code>Save post</code>。</li>
<li>当确认要更新或创建的时候，浏览器使用 <code>jQuery</code> 的 <code>post</code> 方法提交内容到服务器，并获取提交结果，反映到浏览器</li>
<li>当确认要删除的时候，浏览器使用 <code>jQuery</code> 的 <code>post</code> 方法提交要删除的 <code>slug</code> 到服务器，并获取删除结果，反映到浏览器。</li>
</ol>
<p>并且这些要在一个页面里完成。</p>
<h2 id="后端的实际写法"><a href="#%E5%90%8E%E7%AB%AF%E7%9A%84%E5%AE%9E%E9%99%85%E5%86%99%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>后端的实际写法</h2>
<h3 id="api-使用的依赖包"><a href="#api-%E4%BD%BF%E7%94%A8%E7%9A%84%E4%BE%9D%E8%B5%96%E5%8C%85" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>API 使用的依赖包</h3>
<p>先 <code>require</code> 一下各个依赖。</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"express"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fm <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'front-matter'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'highlight.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownItToc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it-toc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> open <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">"\\config.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span>         <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 在源码中启用 HTML 标签</span>
  xhtmlOut<span class="token operator">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 使用 '/' 来闭合单标签 （比如 &lt;br />）。</span>
  breaks<span class="token operator">:</span>       <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 转换段落里的 '\n' 到 &lt;br>。</span>
  langPrefix<span class="token operator">:</span>   <span class="token string">'language-'</span><span class="token punctuation">,</span>  <span class="token comment">// 给围栏代码块的 CSS 语言前缀。对于额外的高亮代码非常有用。</span>
  linkify<span class="token operator">:</span>      <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token comment">// 将类似 URL 的文本自动转换为链接。</span>
  typographer<span class="token operator">:</span>  <span class="token boolean">false</span><span class="token punctuation">,</span>
  quotes<span class="token operator">:</span> <span class="token string">'“”‘’'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">highlight</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>lang <span class="token operator">&&</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">getLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">highlight</span><span class="token punctuation">(</span>lang<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment">// 使用额外的默认转义</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
md<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>markdownItToc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>这里有个 <code>config</code> 是我额外加的配置文件，里面的内容也很简单</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> config <span class="token operator">=</span> <span class="token punctuation">{</span>
    isSlugUseDate<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    blogPath<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'\\blog'</span><span class="token punctuation">,</span>
    imgPath<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">'\\img\\blog'</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> config<span class="token punctuation">;</span>
</code></pre></div>
<p>这个 <code>config</code> 是为了控制 <code>CMS</code> 里面的 <code>Markdown</code> 文件和图片文件的路径，以及 <code>API</code> 返回的 <code>slug</code> 是否使用日期而加的。如果 <code>slug</code> 使用日期，就会是一个长的 <code>slug</code>，比如 <code>2020-04-19-editor-for-my-cms-of-my-nuxt-blog</code>，如果不使用日期，就会是一个短的 <code>slug</code>，比如 <code>editor-for-my-cms-of-my-nuxt-blog</code>，那么相应的，博客文章的 <code>URL</code> 也会有长短之分，就看大家自己喜欢哪一种了。</p>
<h3 id="api-被调用时返回处理后的-html-或原-markdown-内容"><a href="#api-%E8%A2%AB%E8%B0%83%E7%94%A8%E6%97%B6%E8%BF%94%E5%9B%9E%E5%A4%84%E7%90%86%E5%90%8E%E7%9A%84-html-%E6%88%96%E5%8E%9F-markdown-%E5%86%85%E5%AE%B9" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>API 被调用时返回处理后的 HTML 或原 Markdown 内容</h3>
<p>在 <code>API</code> 的入口文件 <code>app.js</code> 里面做一下配置，这样就可以控制返回的文章正文是 <code>Markdown</code> 还是经过处理的 <code>HTML</code> 内容，同时 <code>API</code> 也会按照 <code>config</code> 里面对 <code>slug</code> 的要求，根据所请求的 <code>slug</code> 返回内容。</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">slugToFileName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">slug<span class="token punctuation">,</span>isSlugUseDate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSlugUseDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    result <span class="token operator">=</span> slug<span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> tempSlug <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tempSlug <span class="token operator">==</span> slug<span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        result <span class="token operator">=</span> files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">fileNameToSlug</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span>isSlugUseDate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isSlugUseDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> filename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>filename<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> filename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span>filename<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">singleBlog</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fullPath<span class="token punctuation">,</span>slug<span class="token punctuation">,</span>isContentRequired<span class="token punctuation">,</span>isMD<span class="token punctuation">,</span>isDev</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> blog <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token function">fm</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token method function property-access">readFileSync</span><span class="token punctuation">(</span>fullPath<span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blog <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token property-access">attributes</span><span class="token punctuation">;</span>
  blog<span class="token punctuation">.</span><span class="token property-access">slug</span> <span class="token operator">=</span> slug<span class="token punctuation">;</span>
  <span class="token keyword">var</span> fullFilename <span class="token operator">=</span> fullPath<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  blog<span class="token punctuation">.</span><span class="token property-access">date</span> <span class="token operator">=</span> fullFilename<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isContentRequired <span class="token operator">&&</span> <span class="token operator">!</span>isMD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'@[toc]( )\n'</span> <span class="token operator">+</span> content<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//if isDev then use absolute path for images</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isDev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">src=<span class="token escape">\"</span><span class="token group punctuation">(</span><span class="token escape">\/</span><span class="token group punctuation">)</span><span class="token quantifier number">?</span>img</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"src=\"http://127.0.0.1:4000/img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// add class "hljs" for dark theme rendering</span>
    blog<span class="token punctuation">.</span><span class="token property-access">content</span> <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token escape">\&lt;</span>pre</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"&lt;pre class='hljs'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>isContentRequired <span class="token operator">&&</span> isMD<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    blog<span class="token punctuation">.</span><span class="token property-access">content</span> <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> blog<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//return blog related contents</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/blog"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// allow cross orign access</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> blogPath <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> imgPath <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">imgPath</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> files <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>blogPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> json <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// result to be returned</span>
  <span class="token keyword">var</span> qSlug <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">slug</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qTag <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">tag</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qImg <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">img</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qIsMD <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">ismd</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> qIsDev <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">isdev</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> isSlugUseDate <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token property-access">query</span><span class="token punctuation">.</span><span class="token property-access">iseditor</span> <span class="token operator">==</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token boolean">true</span><span class="token operator">:</span>config<span class="token punctuation">.</span><span class="token property-access">isSlugUseDate</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qSlug<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with blog slug query</span>
    json <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>blogPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">slugToFileName</span><span class="token punctuation">(</span>qSlug<span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>qSlug<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>qIsMD<span class="token punctuation">,</span>qIsDev<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// add prev and next blog</span>
      <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qSlug <span class="token operator">==</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">next</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>k <span class="token operator">===</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">prev</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
          json<span class="token punctuation">.</span><span class="token property-access">prev</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
          json<span class="token punctuation">.</span><span class="token property-access">next</span> <span class="token operator">=</span> <span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qTag<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with tag query</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qTag <span class="token operator">==</span> <span class="token string">"all_tags"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// returns list of all available tags</span>
      json<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tags <span class="token operator">=</span> blogPost<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token string">'none'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span>
          slug<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">slug</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">tags</span><span class="token punctuation">[</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span><span class="token comment">// returns blog list of specific tag</span>
      json<span class="token punctuation">.</span><span class="token property-access">blogs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> tags <span class="token operator">=</span> blogPost<span class="token punctuation">.</span><span class="token property-access">tags</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token string">'none'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">{</span>
          title<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">title</span><span class="token punctuation">,</span>
          slug<span class="token operator">:</span> blogPost<span class="token punctuation">.</span><span class="token property-access">slug</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> tags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>tags<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> qTag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            json<span class="token punctuation">.</span><span class="token property-access">blogs</span><span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>blogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qImg<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// with img query</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>qImg <span class="token operator">==</span> <span class="token string">"all_imgs"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      json<span class="token punctuation">.</span><span class="token property-access">imgs</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> imgFolders <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> imgFolders<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> imgs <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token method function property-access">readdirSync</span><span class="token punctuation">(</span>imgPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>imgFolders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token punctuation">.</span><span class="token property-access">imgs</span><span class="token punctuation">[</span>imgFolders<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> imgs<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span><span class="token comment">//without requirement, returns list of all blogs</span>
    json<span class="token punctuation">.</span><span class="token property-access">blogs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> files<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> blogPost <span class="token operator">=</span> <span class="token function">singleBlog</span><span class="token punctuation">(</span>blogPath<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">fileNameToSlug</span><span class="token punctuation">(</span>files<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>isSlugUseDate<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      json<span class="token punctuation">.</span><span class="token property-access">blogs</span><span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span>blogPost<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/config"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// allow cross orign access</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h3 id="给-api-添加管理后台入口"><a href="#%E7%BB%99-api-%E6%B7%BB%E5%8A%A0%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E5%85%A5%E5%8F%A3" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>给 API 添加管理后台入口</h3>
<p>我在 <code>API</code> 所在的文件夹新建了 <code>app.html</code>，以作为 UI 界面的入口，而要让 <code>API</code> 可以访问这个静态页面，就要像下面这样写</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token comment">//return blog content editor page</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">static</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token method function property-access">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// allow cross orign access</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">header</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token method function property-access">sendFile</span><span class="token punctuation">(</span>__dirname<span class="token operator">+</span><span class="token string">"\\app.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/* nuxt is using port 3000, so choose another one */</span>
app<span class="token punctuation">.</span><span class="token method function property-access">listen</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"express server running at http://127.0.0.1:4000"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>那么这个 <code>CMS</code> 的入口链接就是 <code>http://127.0.0.1:4000/</code> 了。</p>
<p>为了能在开启 <code>API</code> 的时候自动打开浏览器并访问该地址，还需要使用 <code>open</code> 这个 <code>npm</code>，然后加一行打开浏览器的指令</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"http:127.0.0.1:4000/"</span><span class="token punctuation">,</span><span class="token punctuation">{</span>app<span class="token operator">:</span> <span class="token string">"chrome.exe"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>就能直接自动打开浏览器并访问 <code>CMS</code> 的管理界面了。这个界面总共也就一页，所以很好管理。</p>
<h3 id="保存文件和删除文件"><a href="#%E4%BF%9D%E5%AD%98%E6%96%87%E4%BB%B6%E5%92%8C%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>保存文件和删除文件</h3>
<p>之后就是接受浏览器传回来的数据并保存到本地，或者接收浏览器传回的删除指令，删除相关文件。</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token comment">//api to submit post</span>
<span class="token comment">// Parse URL-encoded bodies (as sent by HTML forms)</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> extended<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Parse JSON bodies (as sent by API clients)</span>
app<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token method function property-access">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Access the parse results as request.body</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/savepost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileName <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">writeFileSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> obj<span class="token punctuation">.</span><span class="token property-access">str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Client will get status of failure w/o this</span>
    <span class="token comment">//even if data is saved to server successfully</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// delete post</span>
app<span class="token punctuation">.</span><span class="token method function property-access">post</span><span class="token punctuation">(</span><span class="token string">'/deletepost'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> fileName <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token property-access">blogPath</span><span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>obj<span class="token punctuation">.</span><span class="token property-access">slug</span><span class="token operator">+</span><span class="token string">".md"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token method function property-access">unlinkSync</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//file removed</span>
  <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    <span class="token comment">//Client will get status of failure w/o this</span>
    <span class="token comment">//even if data is saved to server successfully</span>
    res<span class="token punctuation">.</span><span class="token method function property-access">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"status"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<h2 id="前端的实际写法"><a href="#%E5%89%8D%E7%AB%AF%E7%9A%84%E5%AE%9E%E9%99%85%E5%86%99%E6%B3%95" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>前端的实际写法</h2>
<h3 id="调用-api-和渲染-markdown"><a href="#%E8%B0%83%E7%94%A8-api-%E5%92%8C%E6%B8%B2%E6%9F%93-markdown" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>调用 API 和渲染 Markdown</h3>
<p>具体代码其实没什么好说的，文章列表的 <code>API</code> 是 <code>/blogs</code>，而保存文章的 <code>API</code> 是 <code>/savepost</code>，删除文章的 <code>API</code> 是 <code>/deletepost</code>，获取文章列表可以用 <code>jQuery</code> 的 <code>getJSON</code> 方法，而保存和删除可以用 <code>jQuery</code> 的 <code>post</code> 方法。</p>
<p>从编辑区域获取到 <code>Markdown</code> 之后，用 <code>markdown-it</code> 渲染到右边的预览区域，并且给 <code>markdown-it</code> 添加用来生成锚点链接的 <code>markdown-it-toc</code> 和用来高亮代码的 <code>highlight.js</code> 这两个插件，然后给页面引入 <code>github-markdown</code> 这套用来渲染转化后的 <code>HTML</code> 的 <code>css</code> 以及和 <code>highlight.js</code> 配套的 <code>css</code>，差不多就完工了。</p>
<h3 id="渲染-markdown-时的注意事项"><a href="#%E6%B8%B2%E6%9F%93-markdown-%E6%97%B6%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>渲染 Markdown 时的注意事项</h3>
<p>但是这里可能要注意一下原本在 <code>Node</code> 里使用的模块在引入浏览器时的用法。</p>
<p>原本作为 <code>Node</code> 模块使用的时候，先</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> markdownIt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> hljs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'highlight.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> markdownItToc <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'markdown-it-toc'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>然后</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">var</span> md <span class="token operator">=</span> <span class="token function">markdownIt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  html<span class="token operator">:</span>         <span class="token boolean">false</span><span class="token punctuation">,</span>
  xhtmlOut<span class="token operator">:</span>     <span class="token boolean">false</span><span class="token punctuation">,</span>
  breaks<span class="token operator">:</span>       <span class="token boolean">false</span><span class="token punctuation">,</span>
  langPrefix<span class="token operator">:</span>   <span class="token string">'language-'</span><span class="token punctuation">,</span>
  linkify<span class="token operator">:</span>      <span class="token boolean">false</span><span class="token punctuation">,</span>
  typographer<span class="token operator">:</span>  <span class="token boolean">false</span><span class="token punctuation">,</span>
  quotes<span class="token operator">:</span> <span class="token string">'“”‘’'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">highlight</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>lang <span class="token operator">&&</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">getLanguage</span><span class="token punctuation">(</span>lang<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> hljs<span class="token punctuation">.</span><span class="token method function property-access">highlight</span><span class="token punctuation">(</span>lang<span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword control-flow">catch</span> <span class="token punctuation">(</span>__<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
md<span class="token punctuation">.</span><span class="token method function property-access">use</span><span class="token punctuation">(</span>markdownItToc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div>
<p>就可以用来渲染 <code>Markdown</code> 了。</p>
<p>但是在浏览器里用的时候总是报错，这个对象找不到，那个对象也找不到，反正我就是没有对象就是了。</p>
<p>后来才发现，作者在写成浏览器用的版本时，暴露出来的变量名的大小写跟我引用的不一样。</p>
<p>我挨个 <code>js</code> 文件打开，发现<code>markdown-it</code> 在浏览器里的变量名是 <code>markdownit</code>，而用来生成锚点链接的 <code>markdown-it-toc</code> 的变量名是 <code>markdownitTOC</code>，于是我把自己的脚本里面的变量名改成跟原变量名一致，然后就有对象可以用了。</p>
<p>这个问题本来不应该是问题的，实在是让人懊恼。</p>
<h3 id="添加页内平滑滚动效果"><a href="#%E6%B7%BB%E5%8A%A0%E9%A1%B5%E5%86%85%E5%B9%B3%E6%BB%91%E6%BB%9A%E5%8A%A8%E6%95%88%E6%9E%9C" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>添加页内平滑滚动效果</h3>
<p>由于文章预览区域加了锚点链接，我希望能做到禁止直接跳转 <code>#</code> 开头的锚点链接，而是平滑滚动到相关位置，这个部分的代码如下：</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-javascript"><code><span class="token keyword">function</span> <span class="token function">updatePreview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> source <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#editor"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">"\t"</span> <span class="token operator">+</span> md<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">'[toc]\n'</span> <span class="token operator">+</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
  html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token escape">\&lt;</span>a</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span><span class="token string">"&lt;a target='_blank'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#preview"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//add scrollIntoView to anchor link</span>
  <span class="token keyword">var</span> aTags <span class="token operator">=</span> d<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"a[href]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> aTags<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> e <span class="token operator">||</span> event<span class="token punctuation">;</span>
        c<span class="token punctuation">.</span><span class="token method function property-access">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> href <span class="token operator">=</span> aTags<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">href</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> hashPos <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> id <span class="token operator">=</span> href<span class="token punctuation">.</span><span class="token method function property-access">substring</span><span class="token punctuation">(</span>hashPos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> href<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        d<span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">"a[id='"</span><span class="token operator">+</span><span class="token known-class-name class-name">String</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"']"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">{</span>behavior<span class="token operator">:</span> <span class="token string">"smooth"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<h2 id="大概是这么个效果"><a href="#%E5%A4%A7%E6%A6%82%E6%98%AF%E8%BF%99%E4%B9%88%E4%B8%AA%E6%95%88%E6%9E%9C" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>大概是这么个效果</h2>
<p>需要访问 <code>API</code> 的时候，可以 <code>cd</code> 进入该 <code>API</code> 的文件夹，然后</p>
<div class="nuxt-content-highlight"><pre class="line-numbers language-text"><code>node app.js
</code></pre></div>
<p>再在浏览器里打开 <code>http://127.0.0.1:4000/</code> 这个页面，就能看到文章列表，可以增、删、改文章了。参考以下截图</p>
<p><img alt="preview" src="/img/blog/2020-04-19/001.png"></p>
<h2 id="心得体会"><a href="#%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A" aria-hidden="true" tabindex="-1"><span class="icon icon-link"></span></a>心得体会</h2>
<p>今天终于把我心心念念想了一年的东西做出来了，而且只花了一天的时间，真的很开心。</p>
<p>我给它取名叫 <code>April CMS</code>，因为我是在四月里写成的。</p>
<p>做完之后我又研究了下，觉得这个单页面的 <code>CMS</code> 既符合 <code>基于 API 的 Headless CMS</code> 的特征，又符合 <code>Flat File CMS</code> 的特征，也就是 <code>不操作数据库而是操作文本文件的 CMS</code>，感觉好像很高级嘛~</p>
<p>而且预览区和目录区都会随着输入和保存、删除等动作自动更新，写作时无比丝滑顺畅，拿来写文档、写小说啥的好像都不错。</p>
<p>啊，我不知道怎么夸自己才好了。</p>
<p>不说这些肉麻的，总之这次写了个有用的东西，希望以后也能写出更多有用的东西。</p></div></article> <div class="prev-next"><a href="/blog/script-for-photoshop-bulk-resize-and-watermark-en" title="Write a JavaScript script for Photoshop image batch processing" class="no-decor-link"><div class="prev"><p>Previous:<br> <span class="title">Write a JavaScript script for Photoshop image batch processing</span></p></div></a> <a href="/blog/editor-for-my-cms-of-my-nuxt-blog-en" title="Write a control panel for my API-based CMS for Nuxt" class="no-decor-link"><div class="next"><p>Next:<br> <span class="title">Write a control panel for my API-based CMS for Nuxt</span></p></div></a></div> <p> </p> <h3 class="align-center" style="margin-bottom:0"><span>You may also like</span></h3> <div class="pic-showcase" style="margin-top:0"><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/0ea1e7/2912468073/il_340x340.2912468073_8grx.jpg)"><div class="pic-showcase-unit-tag">USD 10.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/template-ebay-desc" title="eBay template builder tool | listing item detail page description HTML generator | mobile responsive | no active content | instant download" target=""><span class="title">eBay template builder tool | listing item detail page description HTML generator | mobile responsive | no active content | instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/002b6c/2881264109/il_340x340.2881264109_qo8o.jpg)"><div class="pic-showcase-unit-tag">USD 1.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-8-page" title="2021 Pocket mini Calendar 8 page foldable printable A7 size DIY zine style A4 paper PDF format instant download" target=""><span class="title">2021 Pocket mini Calendar 8 page foldable printable A7 size DIY zine style A4 paper PDF format instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/7a7880/2863101521/il_340x340.2863101521_88kc.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-weekly" title="2021 weekly schedule planner | 10 types simple to-do list checklist calendar | printable A4 PDF editable excel template instant download" target=""><span class="title">2021 weekly schedule planner | 10 types simple to-do list checklist calendar | printable A4 PDF editable excel template instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/c0ac13/2861084883/il_340x340.2861084883_qz8s.jpg)"><div class="pic-showcase-unit-tag">USD 1.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-100-day" title="100 day challenge planner | simple calendar | goal progress tracker | schedule A4 printable PDF excel template download" target=""><span class="title">100 day challenge planner | simple calendar | goal progress tracker | schedule A4 printable PDF excel template download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/42e083/2864671639/il_340x340.2864671639_1v9f.jpg)"><div class="pic-showcase-unit-tag">USD 3.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-monthly-elegant" title="2021 monthly calendar planner | elegant water blue theme simple | A4 printable PDF instant digital download" target=""><span class="title">2021 monthly calendar planner | elegant water blue theme simple | A4 printable PDF instant digital download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/6691ba/2815904808/il_340x340.2815904808_qn87.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/excel-bill-tracker" title="2021 income expense track | annual monthly daily expenditure | bill spending tracker | personal financial statement | excel template" target=""><span class="title">2021 income expense track | annual monthly daily expenditure | bill spending tracker | personal financial statement | excel template</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/54d699/2881129977/il_340x340.2881129977_n9ly.jpg)"><div class="pic-showcase-unit-tag">USD 2.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-annual" title="multi year annual calendar | editable 2021 to 2030 selection excel template | three column | printable PDF xlsx instant download" target=""><span class="title">multi year annual calendar | editable 2021 to 2030 selection excel template | three column | printable PDF xlsx instant download</span></a> <!----></div> <!----></div></div><div class="pic-showcase-unit-4 h-auto mobile-hidden"><div class="pic-showcase-bg h-200 pos-relative rectangle-bottom" style="background-image:url(https://i.etsystatic.com/20529188/c/2000/2000/0/0/il/f95279/2863789693/il_340x340.2863789693_47rx.jpg)"><div class="pic-showcase-unit-tag">USD 3.00</div></div> <div class="pic-showcase-text-below"><div class="pic-showcase-title"><a href="/store/calendar-monthly-vertical" title="2021 monthly calendar weekly schedule planner | multi year 8-color simple calendar | printable PDF with editable excel template download" target=""><span class="title">2021 monthly calendar weekly schedule planner | multi year 8-color simple calendar | printable PDF with editable excel template download</span></a> <!----></div> <!----></div></div></div> <p> </p> <div><h3 class="align-center"><span style="border-bottom:2px solid #000">Related Posts</span></h3> <div class="blog-gallery"><div class="blog-gallery-unit"><a href="/blog/summary-of-my-life-in-2019" title="我的2019年过得还算充实，看了很多剧，追了很多星，做了很多事，还学了很多东西，要继续保持。" class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>2019年的小总结</h4> <p><span class="blog-date"><i class="fa fa-calendar"></i>
               2020-01-31
            </span> <span class="blog-gallery-lang">
              中文
            </span></p> <p class="align-left"><span class="blog-gallery-desc">我的2019年过得还算充实，看了很多剧，追了很多星，做了很多事，还学了很多东西，要继续保持。</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                技术
              </span><span class="blog-gallery-tag">
                生活
              </span><span class="blog-gallery-tag">
                剧评
              </span><span class="blog-gallery-tag">
                Excel
              </span></span></p></div></a></div><div class="blog-gallery-unit"><a href="/blog/nuxt-blog-static-website" title="重构了一下博客，从Jekyll迁移到了Nuxt。方法是先用Node API 来解析 Markdown 文件，然后 Nuxt+Axios 获取 API 返回的文章内容并生成静态页面。" class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>如何使用Nuxt建立个人博客</h4> <p><span class="blog-date"><i class="fa fa-calendar"></i>
               2019-05-05
            </span> <span class="blog-gallery-lang">
              中文
            </span></p> <p class="align-left"><span class="blog-gallery-desc">重构了一下博客，从Jekyll迁移到了Nuxt。方法是先用Node API 来解析 Markdown 文件，然后 Nuxt+Axios 获取 API 返回的文章内容并生成静态页面。</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                我的项目
              </span><span class="blog-gallery-tag">
                Node.js
              </span><span class="blog-gallery-tag">
                Nuxt.js
              </span><span class="blog-gallery-tag">
                静态博客
              </span><span class="blog-gallery-tag">
                技术
              </span></span></p></div></a></div></div></div> <div id="comment"></div></section></div></main> <footer><p>Created with Nuxt.js <br>
    	Designed by  
    	<a href="https://github.com/c53hzn" target="_blank" class="no-decor-link"><strong>Jenny HOU</strong> <i class="fa fa-github font-20"></i></a></p> <div class="go-top go-top-hidden"><div class="arrow"></div> <div class="stick"></div></div></footer></div></div></div><script defer src="/_nuxt/static/1615117240/blog/editor-for-my-cms-of-my-nuxt-blog/state.js"></script><script src="/_nuxt/2a7fd5a.js" defer></script><script src="/_nuxt/22b5e3c.js" defer></script><script src="/_nuxt/6280bdd.js" defer></script><script src="/_nuxt/fe0f673.js" defer></script><script src="/_nuxt/f975ada.js" defer></script>
  </body>
</html>
