<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">如何减轻Nuxt打包生成的代码量 | Jenny的小站</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"><link data-n-head="true" rel="stylesheet" href="/style.css"><link data-n-head="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"><link data-n-head="true" rel="stylesheet" href="/highlight.js.css"><script data-n-head="true" src="/statcounter.js"></script><base href="/"><link rel="preload" href="/_nuxt/6c539c0dff3550c1ccdb.js" as="script"><link rel="preload" href="/_nuxt/ec0b83a3fb195aad8df5.js" as="script"><link rel="preload" href="/_nuxt/9b4b0572775df438c5d4.js" as="script"><link rel="preload" href="/_nuxt/54333660f1a0bb9747d1.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 3887c203:0 498b36b5:0 1b56ffbd:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}nav[data-v-296f7818]{position:fixed;top:0;left:0;right:0;bottom:0;height:40px;box-shadow:0 0 1px 0 rgba(0,0,0,.6);z-index:9999}.nav-wrap[data-v-296f7818],nav[data-v-296f7818]{background:inherit}.nav-wrap[data-v-296f7818]{margin:0 auto;width:800px;height:100%;display:flex;justify-content:space-between}header[data-v-296f7818]{font-family:Gugi,cursive;margin:0 0 0 10px;height:100%;z-index:2}.nav-ul[data-v-296f7818],header h2[data-v-296f7818]{margin:0;height:100%}header a[data-v-296f7818]{text-decoration:none}header a[data-v-296f7818]:active,header a[data-v-296f7818]:visited{color:inherit}.font-impact[data-v-296f7818]{font-family:Impact}.nav-ul[data-v-296f7818]{list-style:none;text-align:right;display:flex;justify-content:center;z-index:1}.nav-link[data-v-296f7818]{margin-right:20px;height:100%;text-decoration:none}.nav-link[data-v-296f7818]:last{margin-right:10px}.nav-link[data-v-296f7818]:active{color:inherit}.nav-link li[data-v-296f7818],header h2[data-v-296f7818]{color:#000;height:100%;line-height:40px}.nav-link li[data-v-296f7818]:hover{color:grey}.nav-link[data-v-296f7818]:visited{color:inherit}.nuxt-link-active[data-v-296f7818]{border-bottom:1px solid #000}.nav-mask[data-v-296f7818]{height:40px;background:inherit;z-index:0}.body-mask[data-v-296f7818],.nav-mask[data-v-296f7818]{position:fixed;width:100%}.body-mask[data-v-296f7818]{height:0;transition:height .8s;background:rgba(0,0,0,.5)}.body-mask-visible[data-v-296f7818]{height:100%}.nav-btn[data-v-296f7818]{width:40px;height:40px;display:none;z-index:2}.bar[data-v-296f7818]{width:70%;height:25%;text-align:center;border-bottom:2px solid #000}.bar[data-v-296f7818]:last-child{border:none}@media (max-width:768px){.nav-wrap[data-v-296f7818],nav[data-v-296f7818]{width:100%}}@media (max-width:425px){nav[data-v-296f7818]{box-shadow:none}.nav-mask[data-v-296f7818]{border-bottom:1px solid grey;z-index:1}.nav-ul[data-v-296f7818]{position:fixed;margin-top:40px;padding:0;width:100%;height:auto;-webkit-transform:translateY(-100%);transform:translateY(-100%);text-align:left;background:#fff;transition:-webkit-transform .8s;transition:transform .8s;transition:transform .8s,-webkit-transform .8s;display:block;overflow:hidden;z-index:0}.nav-mobile[data-v-296f7818]{-webkit-transform:translateY(0);transform:translateY(0)}.nav-link[data-v-296f7818]{margin:0 10px;padding:12px 0 0;height:auto;line-height:20px;border-bottom:1px solid #000;display:block}.nav-link[data-v-296f7818]:last-child{margin-bottom:10px}.nav-link li[data-v-296f7818]{margin-left:10px;margin-right:10px;width:auto;line-height:20px}.nav-btn[data-v-296f7818]{display:block}}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}.youtube-img{position:relative;display:inline-block}.youtube-img:before{width:40%;height:40%;border-radius:25%;background:red}.youtube-img:after,.youtube-img:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;transition:opacity .2s}.youtube-img:after{width:0;height:0;border-top:10px solid transparent;border-left:20px solid #fff;border-bottom:10px solid transparent}.youtube-img:hover:after,.youtube-img:hover:before{opacity:.7;transition:opacity .2s}footer[data-v-f59b3114]{padding:20px;border-top:1px solid rgba(0,0,0,.6)}p[data-v-f59b3114]{margin:0 auto;font-size:14px;text-align:center}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav data-v-296f7818><div class="nav-wrap" data-v-296f7818><header data-v-296f7818><a href="/" class="no-decor" data-v-296f7818><h2 data-v-296f7818>Jenny's blog</h2></a></header> <div class="nav-btn" data-v-296f7818><div class="bar" data-v-296f7818></div> <div class="bar" data-v-296f7818></div> <div class="bar" data-v-296f7818></div> <div class="bar" data-v-296f7818></div></div> <div class="nav-mask" data-v-296f7818></div> <div class="body-mask" data-v-296f7818></div> <ul class="nav-ul" data-v-296f7818><a href="/resume" class="nav-link" data-v-296f7818><li data-v-296f7818>Resume</li></a><a href="/blogs" class="nav-link nuxt-link-active" data-v-296f7818><li data-v-296f7818>Blogs</li></a></ul></div></nav> <main><div><h1>如何减轻Nuxt打包生成的代码量</h1> <p class="blog-date">2019-05-18</p> <p class="blog-date">
    Tags: 
    <span class="blog-tag"><a href="/blogs/tag/涨知识">涨知识</a></span><span class="blog-tag"><a href="/blogs/tag/Nuxt">Nuxt</a></span></p> <div class="blog-desc">Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown</div> <div class="markdown-body"><h2 id="为什么要移除marked和highlightjs">为什么要移除marked和highlight.js</h2>
<p>本来我的博客页<code>/blogs/_slug.vue</code>是这样渲染从API返回的Markdown内容的</p>
<p>先获取Markdown</p>
<pre><code class="language-javascript">    asyncData({ <span class="hljs-keyword">params</span> }) {
     <span class="hljs-keyword">return</span> axios.<span class="hljs-keyword">get</span>(<span class="hljs-string">'http://127.0.0.1:4000?slug='</span>+<span class="hljs-keyword">params</span>.slug).then(res => {
       <span class="hljs-keyword">let</span> blog = res.data;
       <span class="hljs-keyword">let</span> space = [];
       <span class="hljs-keyword">let</span> tags = blog.tags || [<span class="hljs-string">'none'</span>];
       <span class="hljs-keyword">return</span> {
         blog: blog,
         tags: tags,
         date: <span class="hljs-keyword">params</span>.slug.substring(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>),
         baseURL: myConfig.baseURL
       };
     })
    }</code></pre>
<p>然后用<code>computed</code>去处理Markdown内容</p>
<pre><code class="language-javascript">    <span class="hljs-keyword">import</span> marked <span class="hljs-keyword">from</span> <span class="hljs-string">'marked'</span>;
    <span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);
    computed: {
        <span class="hljs-attr">compiledMarkdown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();
            <span class="hljs-keyword">var</span> html = marked(<span class="hljs-keyword">this</span>.blog.content, {
                <span class="hljs-attr">renderer</span>: rendererMD,
                <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
                    <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value
                }
            });
            ... <span class="hljs-comment">//其他处理</span>
            <span class="hljs-keyword">return</span> html;
        }
    }</code></pre>
<p>可是这样的话，marked和highlight.js都会被打包进最后的代码里，造成网站臃肿。此外每次打开单个博客页还是会调用这些不需要的代码，造成页面加载缓慢，前两天写的文章<a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt">《如何使用Nuxt建立个人博客》</a>部署到服务器之后竟然需要一分多钟才能完全加载好，而在开发模式下也就几秒钟就加载好了。</p>
<p>看来优化网站刻不容缓了。</p>
<h2 id="博客页移除marked和highlightjs">博客页移除marked和highlight.js</h2>
<p>然后我试了下把marked和highlight.js从<code>/blogs/_slug.vue</code>移除，<code>asyncData</code>从API获取内容的部分不变，只是在<code>computed</code>部分减掉了相关处理，然后再次生成静态网页，整个网站代码量立刻轻了很多，如图</p>
<p><strong>before</strong><br><img src="/img/blogs/dist-before-removing-marked-and-highlightjs.png" alt="before" title="before"></p>
<p><strong>after</strong><br><img src="/img/blogs/dist-after-removing-marked-and-highlightjs.png" alt="after" title="after"></p>
<h2 id="在api内添加markdown转html的处理">在API内添加Markdown转HTML的处理</h2>
<p>接下来是重头戏了，我们不在博客页渲染Markdown，而是直接在json里获取一个渲染后的HTML，那么这个HTML内容是怎么生成的呢？</p>
<p>我的<code>/api/index.js</code>现在是这样写的</p>
<pre><code class="language-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> fm = <span class="hljs-built_in">require</span>(<span class="hljs-string">'front-matter'</span>);
<span class="hljs-keyword">var</span> app = express();
<span class="hljs-keyword">var</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);
<span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);

marked.setOptions({
    <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
        <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value;
    }
});

<span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();
<span class="hljs-keyword">var</span> htmlResult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentBody</span>) </span>{
    <span class="hljs-keyword">return</span> marked(contentBody, {
        <span class="hljs-attr">renderer</span>: rendererMD,
        <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
          <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value
        }
    })
};

<span class="hljs-keyword">var</span> singleBlog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullPath, slug, isContentRequired</span>) </span>{
    <span class="hljs-keyword">var</span> blog = {};
    <span class="hljs-keyword">var</span> content = fm(fs.readFileSync(fullPath, <span class="hljs-string">"utf8"</span>));
    blog = content.attributes;
    blog.slug = slug;
    <span class="hljs-keyword">if</span> (isContentRequired) {
        blog.content = htmlResult(content.body);<span class="hljs-comment">//从Markdown生成HTML</span>
    }
    <span class="hljs-keyword">return</span> blog;
}

app.get(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
    <span class="hljs-comment">// allow cross orign access</span>
    res.header(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'*'</span>);
    <span class="hljs-keyword">var</span> path = __dirname + <span class="hljs-string">'\\blogs'</span>;
    <span class="hljs-keyword">var</span> files = fs.readdirSync(path);

    <span class="hljs-keyword">var</span> json = {};<span class="hljs-comment">// result to be returned</span>

    <span class="hljs-keyword">var</span> qSlug = req.query.slug || <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> qImg = req.query.img || <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> qTag = req.query.tag || <span class="hljs-string">""</span>;
    <span class="hljs-keyword">if</span> (qSlug) {<span class="hljs-comment">// with blog slug query</span>
        json = singleBlog(path+<span class="hljs-string">"\\"</span>+qSlug+<span class="hljs-string">".md"</span>, qSlug, <span class="hljs-literal">true</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qImg) {<span class="hljs-comment">// with img query</span>
        ...
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qTag) {<span class="hljs-comment">// with tag query</span>
        ...
    } <span class="hljs-keyword">else</span> {<span class="hljs-comment">//without requirement, returns list of all blogs</span>
        ...
    }
    res.send(json);
});

app.listen(<span class="hljs-number">4000</span>, () => {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"express server running at http://127.0.0.1:4000"</span>)
});</code></pre>
<p>这样API就会返回一个含有渲染后的HTML的json，我的网站就可以直接用啦。</p>
<p>API经过这样处理之后，反应时间会变慢，但是比起网站经过优化后而减少的反应时间，那是非常不值一提了。</p>
<p>以上~</p>
</div> <div id="disqus_thread"></div></div></main> <footer data-v-f59b3114><p data-v-f59b3114>Created by <strong data-v-f59b3114>Jenny HOU</strong>.</p></footer></div></div></div><script>window.__NUXT__=function(s){return s[0]="涨知识",s[1]="Nuxt",{layout:"default",data:[{blog:{layout:"post",title:"如何减轻Nuxt打包生成的代码量",description:"Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown",tags:s,slug:"2019-05-18-lighten-nuxt-generated-site-by-removing-marked-and-highlightjs",content:'<h2 id="为什么要移除marked和highlightjs">为什么要移除marked和highlight.js</h2>\n<p>本来我的博客页<code>/blogs/_slug.vue</code>是这样渲染从API返回的Markdown内容的</p>\n<p>先获取Markdown</p>\n<pre><code class="language-javascript">    asyncData({ <span class="hljs-keyword">params</span> }) {\n     <span class="hljs-keyword">return</span> axios.<span class="hljs-keyword">get</span>(<span class="hljs-string">\'http://127.0.0.1:4000?slug=\'</span>+<span class="hljs-keyword">params</span>.slug).then(res =&gt; {\n       <span class="hljs-keyword">let</span> blog = res.data;\n       <span class="hljs-keyword">let</span> space = [];\n       <span class="hljs-keyword">let</span> tags = blog.tags || [<span class="hljs-string">\'none\'</span>];\n       <span class="hljs-keyword">return</span> {\n         blog: blog,\n         tags: tags,\n         date: <span class="hljs-keyword">params</span>.slug.substring(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>),\n         baseURL: myConfig.baseURL\n       };\n     })\n    }</code></pre>\n<p>然后用<code>computed</code>去处理Markdown内容</p>\n<pre><code class="language-javascript">    <span class="hljs-keyword">import</span> marked <span class="hljs-keyword">from</span> <span class="hljs-string">\'marked\'</span>;\n    <span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'highlight.js\'</span>);\n    computed: {\n        <span class="hljs-attr">compiledMarkdown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n            <span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();\n            <span class="hljs-keyword">var</span> html = marked(<span class="hljs-keyword">this</span>.blog.content, {\n                <span class="hljs-attr">renderer</span>: rendererMD,\n                <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{\n                    <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value\n                }\n            });\n            ... <span class="hljs-comment">//其他处理</span>\n            <span class="hljs-keyword">return</span> html;\n        }\n    }</code></pre>\n<p>可是这样的话，marked和highlight.js都会被打包进最后的代码里，造成网站臃肿。此外每次打开单个博客页还是会调用这些不需要的代码，造成页面加载缓慢，前两天写的文章<a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt">《如何使用Nuxt建立个人博客》</a>部署到服务器之后竟然需要一分多钟才能完全加载好，而在开发模式下也就几秒钟就加载好了。</p>\n<p>看来优化网站刻不容缓了。</p>\n<h2 id="博客页移除marked和highlightjs">博客页移除marked和highlight.js</h2>\n<p>然后我试了下把marked和highlight.js从<code>/blogs/_slug.vue</code>移除，<code>asyncData</code>从API获取内容的部分不变，只是在<code>computed</code>部分减掉了相关处理，然后再次生成静态网页，整个网站代码量立刻轻了很多，如图</p>\n<p><strong>before</strong><br><img src="/img/blogs/dist-before-removing-marked-and-highlightjs.png" alt="before" title="before"></p>\n<p><strong>after</strong><br><img src="/img/blogs/dist-after-removing-marked-and-highlightjs.png" alt="after" title="after"></p>\n<h2 id="在api内添加markdown转html的处理">在API内添加Markdown转HTML的处理</h2>\n<p>接下来是重头戏了，我们不在博客页渲染Markdown，而是直接在json里获取一个渲染后的HTML，那么这个HTML内容是怎么生成的呢？</p>\n<p>我的<code>/api/index.js</code>现在是这样写的</p>\n<pre><code class="language-javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);\n<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);\n<span class="hljs-keyword">var</span> fm = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'front-matter\'</span>);\n<span class="hljs-keyword">var</span> app = express();\n<span class="hljs-keyword">var</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'marked\'</span>);\n<span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'highlight.js\'</span>);\n\nmarked.setOptions({\n    <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{\n        <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value;\n    }\n});\n\n<span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();\n<span class="hljs-keyword">var</span> htmlResult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentBody</span>) </span>{\n    <span class="hljs-keyword">return</span> marked(contentBody, {\n        <span class="hljs-attr">renderer</span>: rendererMD,\n        <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,\n        <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,\n        <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,\n        <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,\n        <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,\n        <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,\n        <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,\n        <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{\n          <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value\n        }\n    })\n};\n\n<span class="hljs-keyword">var</span> singleBlog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullPath, slug, isContentRequired</span>) </span>{\n    <span class="hljs-keyword">var</span> blog = {};\n    <span class="hljs-keyword">var</span> content = fm(fs.readFileSync(fullPath, <span class="hljs-string">"utf8"</span>));\n    blog = content.attributes;\n    blog.slug = slug;\n    <span class="hljs-keyword">if</span> (isContentRequired) {\n        blog.content = htmlResult(content.body);<span class="hljs-comment">//从Markdown生成HTML</span>\n    }\n    <span class="hljs-keyword">return</span> blog;\n}\n\napp.get(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{\n    <span class="hljs-comment">// allow cross orign access</span>\n    res.header(<span class="hljs-string">\'Access-Control-Allow-Origin\'</span>, <span class="hljs-string">\'*\'</span>);\n    <span class="hljs-keyword">var</span> path = __dirname + <span class="hljs-string">\'\\\\blogs\'</span>;\n    <span class="hljs-keyword">var</span> files = fs.readdirSync(path);\n\n    <span class="hljs-keyword">var</span> json = {};<span class="hljs-comment">// result to be returned</span>\n\n    <span class="hljs-keyword">var</span> qSlug = req.query.slug || <span class="hljs-string">""</span>;\n    <span class="hljs-keyword">var</span> qImg = req.query.img || <span class="hljs-string">""</span>;\n    <span class="hljs-keyword">var</span> qTag = req.query.tag || <span class="hljs-string">""</span>;\n    <span class="hljs-keyword">if</span> (qSlug) {<span class="hljs-comment">// with blog slug query</span>\n        json = singleBlog(path+<span class="hljs-string">"\\\\"</span>+qSlug+<span class="hljs-string">".md"</span>, qSlug, <span class="hljs-literal">true</span>);\n    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qImg) {<span class="hljs-comment">// with img query</span>\n        ...\n    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qTag) {<span class="hljs-comment">// with tag query</span>\n        ...\n    } <span class="hljs-keyword">else</span> {<span class="hljs-comment">//without requirement, returns list of all blogs</span>\n        ...\n    }\n    res.send(json);\n});\n\napp.listen(<span class="hljs-number">4000</span>, () =&gt; {\n    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"express server running at http://127.0.0.1:4000"</span>)\n});</code></pre>\n<p>这样API就会返回一个含有渲染后的HTML的json，我的网站就可以直接用啦。</p>\n<p>API经过这样处理之后，反应时间会变慢，但是比起网站经过优化后而减少的反应时间，那是非常不值一提了。</p>\n<p>以上~</p>\n'},tags:s,date:"2019-05-18",baseURL:"/"}],error:null,serverRendered:!0}}(Array(2))</script><script src="/_nuxt/6c539c0dff3550c1ccdb.js" defer></script><script src="/_nuxt/54333660f1a0bb9747d1.js" defer></script><script src="/_nuxt/ec0b83a3fb195aad8df5.js" defer></script><script src="/_nuxt/9b4b0572775df438c5d4.js" defer></script>
  </body>
</html>
