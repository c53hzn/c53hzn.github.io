<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">如何减轻Nuxt打包生成的代码量 | Jenny的小站</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown"><meta data-n-head="true" data-hid="keyword" name="keyword" content="涨知识, JavaScript, Nuxt"><link data-n-head="true" rel="icon" type="image/x-icon" href="/img/favicon.ico"><link data-n-head="true" rel="stylesheet" href="/css/font-gugi.css"><link data-n-head="true" rel="stylesheet" href="/css/font-poppins.css"><link data-n-head="true" rel="stylesheet" href="/css/style.css?2020-04-12"><link data-n-head="true" rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><link data-n-head="true" rel="stylesheet" href="/css/github-markdown.min.css"><link data-n-head="true" rel="stylesheet" href="/css/highlight.js.css"><link data-n-head="true" rel="stylesheet" href="https://hzn-website.000webhostapp.com/disqus/dist/iDisqus.min.css"><script data-n-head="true" src="/js/statcounter.js"></script><base href="/"><link rel="preload" href="/_nuxt/d62a008b225084d4add7.js" as="script"><link rel="preload" href="/_nuxt/e538c0d34daa29c0b6a1.js" as="script"><link rel="preload" href="/_nuxt/7c2eafc52e6930abbe67.js" as="script"><link rel="preload" href="/_nuxt/b4d4a0baed0e9fb51d3e.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 498b36b5:0 1bd5369a:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.markdown-body{margin-bottom:50px}.markdown-body img{max-height:100px}a[id]{position:relative;top:-40px;display:block}a#comment-link{top:0}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}.youtube-img{position:relative;display:inline-block}.youtube-img:before{width:40%;height:40%;border-radius:25%;background:rgba(0,0,0,.7);transition:background .2s}.youtube-img:after,.youtube-img:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;margin:auto}.youtube-img:after{width:0;height:0;border-top:10px solid transparent;border-left:20px solid #fff;border-bottom:10px solid transparent}.youtube-img:hover:before{background:red}#disqus_thread{margin-top:20px}.prev-next{margin:20px auto;display:block}.prev-next:after{display:table;content:" ";clear:both}.prev-next a{display:inline}.next,.prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:20px auto;width:100%;color:grey;border:1px solid grey;cursor:pointer}.prev{width:48%;text-align:left;float:left}.next{width:48%;text-align:right;float:right}.next:hover,.prev:hover{color:#000;border-color:#000}.prev p{padding-left:16px}.next p,.prev p{margin:0;padding-top:16px;padding-bottom:16px}.next p{padding-right:16px}#comment{margin-top:40px}.blog-gallery{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.blog-gallery-unit{margin:40px 10px 0;width:46%;border:1px solid silver;border-radius:5px}.blog-gallery-unit:first-child,.blog-gallery-unit:nth-child(2){margin-top:20px}.blog-gallery-unit:hover{border-color:#000}.blog-gallery-inner{padding:21px 10px 10px;height:100%}.blog-gallery-inner h4{margin-top:0;max-height:42px;overflow:hidden}.blog-gallery-desc{line-height:21px;max-height:64px;display:block;overflow:hidden}.blog-gallery-tag{margin:1px;padding:0 8px;color:#fff;font-size:12px;font-family:Microsoft Yahei;line-height:20px;border-radius:999px;background:grey;display:inline-block}@media (max-width:425px){.blog-gallery-unit{width:100%}}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav><div class="nav-wrap"><header><a href="/" class="no-decor-link"><p class="nav-home">Jenny's blog</p></a></header> <div class="nav-btn"><div class="bar"></div> <div class="bar"></div> <div class="bar"></div> <div class="bar"></div></div> <div class="nav-mask"></div> <div class="body-mask"></div> <ul class="nav-ul"><a href="/" target="_self" class="nav-link"><li>首页<!----><!----></li></a><a href="/resume" target="_self" class="nav-link"><li>简历<!----><!----></li></a><a href="/blogs" target="_self" class="nav-link nuxt-link-active"><li>博客<!----><!----></li></a><a href="https://wj.qq.com/s2/3731207/f0cd/" target="_blank" class="nav-link"><li>联系我<span> </span><i class="fa fa-external-link"></i></li></a></ul></div></nav> <main><div><section class="main-content"><h1 class="align-center">如何减轻Nuxt打包生成的代码量</h1> <p class="blog-date align-center"><span class="fa fa-calendar"> 2019-05-18</span></p> <p class="blog-tags align-center"><a href="/blogs/tag/涨知识"><span class="blog-tag">涨知识</span></a><a href="/blogs/tag/JavaScript"><span class="blog-tag">JavaScript</span></a><a href="/blogs/tag/Nuxt"><span class="blog-tag">Nuxt</span></a></p> <div class="blog-desc">Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown</div> <article class="markdown-body"><p></p><h3> </h3><ul><li><a href="blogs/2019-05-18-lighten-nuxt-generated-site-by-removing-marked-and-highlightjs#markedhighlightjs_1">为什么要移除marked和highlight.js</a></li><li><a href="blogs/2019-05-18-lighten-nuxt-generated-site-by-removing-marked-and-highlightjs#markedhighlightjs_53">博客页移除marked和highlight.js</a></li><li><a href="blogs/2019-05-18-lighten-nuxt-generated-site-by-removing-marked-and-highlightjs#APIMarkdownHTML_63">在API内添加Markdown转HTML的处理</a></li></ul><p></p>
<h1><a id="markedhighlightjs_1"></a>为什么要移除marked和highlight.js</h1>
<p>本来我的博客页<code>/blogs/_slug.vue</code>是这样渲染从API返回的Markdown内容的</p>
<p>先获取Markdown</p>
<pre><code class="language-javascript">	asyncData(context) {
	 <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'http://127.0.0.1:4000?slug='</span>+context.params.slug).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> {
	   <span class="hljs-keyword">let</span> blog = res.data;
	   <span class="hljs-keyword">let</span> space = [];
	   <span class="hljs-keyword">return</span> {
	     <span class="hljs-attr">blog</span>: blog,
	     <span class="hljs-attr">tags</span>: blog.tags || [<span class="hljs-string">'none'</span>],
	     <span class="hljs-attr">date</span>: params.slug.substring(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>),
	     <span class="hljs-attr">baseURL</span>: context.app.router.options.base
	   };
	 })
	}
</code></pre>
<p>然后用<code>computed</code>去处理Markdown内容</p>
<pre><code class="language-javascript">    <span class="hljs-keyword">import</span> marked <span class="hljs-keyword">from</span> <span class="hljs-string">'marked'</span>;
    <span class="hljs-keyword">import</span> hljs <span class="hljs-keyword">from</span> <span class="hljs-string">'highlight.js'</span>;
    computed: {
        <span class="hljs-attr">compiledMarkdown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();
            <span class="hljs-keyword">var</span> html = marked(<span class="hljs-keyword">this</span>.blog.content, {
                <span class="hljs-attr">renderer</span>: rendererMD,
                <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
                    <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value
                }
            });
            ... <span class="hljs-comment">//其他处理</span>
            <span class="hljs-keyword">return</span> html;
        }
    }
</code></pre>
<p>可是这样的话，marked和highlight.js都会被打包进最后的代码里，造成网站臃肿。此外每次打开单个博客页还是会调用这些不需要的代码，造成页面加载缓慢，前两天写的文章<a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt">《如何使用Nuxt建立个人博客》</a>部署到服务器之后竟然需要一分多钟才能完全加载好，而在开发模式下也就几秒钟就加载好了。</p>
<p>看来优化网站刻不容缓了。</p>
<h1><a id="markedhighlightjs_53"></a>博客页移除marked和highlight.js</h1>
<p>然后我试了下把marked和highlight.js从<code>/blogs/_slug.vue</code>移除，<code>asyncData</code>从API获取内容的部分不变，只是在<code>computed</code>部分减掉了相关处理，然后再次生成静态网页，整个网站代码量立刻轻了很多，如图</p>
<p><strong>before</strong><br>
<img src="/img/blogs/2019-05-18/001.png" alt="before" title="before"></p>
<p><strong>after</strong><br>
<img src="/img/blogs/2019-05-18/002.png" alt="after" title="after"></p>
<h1><a id="APIMarkdownHTML_63"></a>在API内添加Markdown转HTML的处理</h1>
<p>接下来是重头戏了，我们不在博客页渲染Markdown，而是直接在json里获取一个渲染后的HTML，那么这个HTML内容是怎么生成的呢？</p>
<p>我的<code>/api/index.js</code>现在是这样写的</p>
<pre><code class="language-javascript">	<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);
	<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
	<span class="hljs-keyword">var</span> fm = <span class="hljs-built_in">require</span>(<span class="hljs-string">'front-matter'</span>);
	<span class="hljs-keyword">var</span> app = express();
	<span class="hljs-keyword">var</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);
	<span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'highlight.js'</span>);

	<span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();
	<span class="hljs-keyword">var</span> htmlResult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentBody</span>) </span>{
		<span class="hljs-keyword">return</span> marked(contentBody, {
			<span class="hljs-attr">renderer</span>: rendererMD,
			<span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,
			<span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,
			<span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
			  <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value
			}
		})
	};

	<span class="hljs-keyword">var</span> singleBlog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullPath, slug, isContentRequired</span>) </span>{
		<span class="hljs-keyword">var</span> blog = {};
		<span class="hljs-keyword">var</span> content = fm(fs.readFileSync(fullPath, <span class="hljs-string">"utf8"</span>));
		blog = content.attributes;
		blog.slug = slug;
		<span class="hljs-keyword">if</span> (isContentRequired) {
			blog.content = htmlResult(content.body);<span class="hljs-comment">//从Markdown生成HTML</span>
		}
		<span class="hljs-keyword">return</span> blog;
	}

	app.get(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{
		<span class="hljs-comment">// allow cross orign access</span>
		res.header(<span class="hljs-string">'Access-Control-Allow-Origin'</span>, <span class="hljs-string">'*'</span>);
		<span class="hljs-keyword">var</span> path = __dirname + <span class="hljs-string">'\\blogs'</span>;
		<span class="hljs-keyword">var</span> files = fs.readdirSync(path);

		<span class="hljs-keyword">var</span> json = {};<span class="hljs-comment">// result to be returned</span>

		<span class="hljs-keyword">var</span> qSlug = req.query.slug || <span class="hljs-string">""</span>;
		<span class="hljs-keyword">var</span> qImg = req.query.img || <span class="hljs-string">""</span>;
		<span class="hljs-keyword">var</span> qTag = req.query.tag || <span class="hljs-string">""</span>;
		<span class="hljs-keyword">if</span> (qSlug) {<span class="hljs-comment">// with blog slug query</span>
			json = singleBlog(path+<span class="hljs-string">"\\"</span>+qSlug+<span class="hljs-string">".md"</span>, qSlug, <span class="hljs-literal">true</span>);
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qImg) {<span class="hljs-comment">// with img query</span>
			...
		} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qTag) {<span class="hljs-comment">// with tag query</span>
			...
		} <span class="hljs-keyword">else</span> {<span class="hljs-comment">//without requirement, returns list of all blogs</span>
			...
		}
		res.send(json);
	});

	app.listen(<span class="hljs-number">4000</span>, () => {
		<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"express server running at http://127.0.0.1:4000"</span>)
	});
</code></pre>
<p>这样API就会返回一个含有渲染后的HTML的json，我的网站就可以直接用啦。</p>
<p>当然别忘了在博客页引入<code>highlight.js</code>的css，否则好不容易渲染好了HTML，却没了样式，那就不好了。</p>
<p>API经过这样处理之后，反应时间会变慢，但是比起网站经过优化后而减少的反应时间，那是非常不值一提了。</p>
<p>以上~</p>
</article> <div class="prev-next"><a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt" class="no-decor-link"><div class="prev"><p>上一篇</p></div></a> <a href="/blogs/2019-05-25-takarazuka-musical" class="no-decor-link"><div class="next"><p>下一篇</p></div></a></div> <div><h3 style="text-align:center"><span style="border-bottom:2px solid #000">相关文章</span></h3> <div class="blog-gallery"><div class="blog-gallery-unit"><a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt" title="重构了一下博客，从Jekyll迁移到了Nuxt。方法是先用Node API 来解析 Markdown 文件，然后 Nuxt+Axios 获取 API 返回的文章内容并生成静态页面。" class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>如何使用Nuxt建立个人博客</h4> <p class="blog-date"><span class="fa fa-calendar">
               2019-05-05
            </span></p> <p class="align-left"><span class="blog-gallery-desc">重构了一下博客，从Jekyll迁移到了Nuxt。方法是先用Node API 来解析 Markdown 文件，然后 Nuxt+Axios 获取 API 返回的文章内容并生成静态页面。</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                涨知识
              </span><span class="blog-gallery-tag">
                JavaScript
              </span><span class="blog-gallery-tag">
                Nuxt
              </span><span class="blog-gallery-tag">
                静态博客
              </span></span></p></div></a></div></div></div> <div id="comment"></div></section></div></main> <footer><p>Created with Nuxt.js <br>
    	Made by  
    	<a href="https://github.com/c53hzn" target="_blank" class="no-decor-link"><strong>Jenny HOU</strong> <i class="fa fa-github font-20"></i></a></p> <div class="go-top go-top-hidden"><div class="arrow"></div> <div class="stick"></div></div></footer></div></div></div><script>window.__NUXT__=function(s,a,n,l,t,p,e,r){return t[0]="涨知识",t[1]=e,t[2]=r,{layout:"page",data:[{blog:{layout:l,title:"如何减轻Nuxt打包生成的代码量",description:"Nuxt默认会将所有vue文件使用的模块打包进最后的网站文件，所以最好不要在博客页渲染Markdown",related_blog:[s],tags:t,comments:!0,slug:n,content:'<p><h3> </h3><ul><li><a href="#markedhighlightjs_1">为什么要移除marked和highlight.js</a></li><li><a href="#markedhighlightjs_53">博客页移除marked和highlight.js</a></li><li><a href="#APIMarkdownHTML_63">在API内添加Markdown转HTML的处理</a></li></ul></p>\n<h1><a id="markedhighlightjs_1"></a>为什么要移除marked和highlight.js</h1>\n<p>本来我的博客页<code>/blogs/_slug.vue</code>是这样渲染从API返回的Markdown内容的</p>\n<p>先获取Markdown</p>\n<pre><code class="language-javascript">\tasyncData(context) {\n\t <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">\'http://127.0.0.1:4000?slug=\'</span>+context.params.slug).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {\n\t   <span class="hljs-keyword">let</span> blog = res.data;\n\t   <span class="hljs-keyword">let</span> space = [];\n\t   <span class="hljs-keyword">return</span> {\n\t     <span class="hljs-attr">blog</span>: blog,\n\t     <span class="hljs-attr">tags</span>: blog.tags || [<span class="hljs-string">\'none\'</span>],\n\t     <span class="hljs-attr">date</span>: params.slug.substring(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>),\n\t     <span class="hljs-attr">baseURL</span>: context.app.router.options.base\n\t   };\n\t })\n\t}\n</code></pre>\n<p>然后用<code>computed</code>去处理Markdown内容</p>\n<pre><code class="language-javascript">    <span class="hljs-keyword">import</span> marked <span class="hljs-keyword">from</span> <span class="hljs-string">\'marked\'</span>;\n    <span class="hljs-keyword">import</span> hljs <span class="hljs-keyword">from</span> <span class="hljs-string">\'highlight.js\'</span>;\n    computed: {\n        <span class="hljs-attr">compiledMarkdown</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{\n            <span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();\n            <span class="hljs-keyword">var</span> html = marked(<span class="hljs-keyword">this</span>.blog.content, {\n                <span class="hljs-attr">renderer</span>: rendererMD,\n                <span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,\n                <span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,\n                <span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{\n                    <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value\n                }\n            });\n            ... <span class="hljs-comment">//其他处理</span>\n            <span class="hljs-keyword">return</span> html;\n        }\n    }\n</code></pre>\n<p>可是这样的话，marked和highlight.js都会被打包进最后的代码里，造成网站臃肿。此外每次打开单个博客页还是会调用这些不需要的代码，造成页面加载缓慢，前两天写的文章<a href="/blogs/2019-05-05-set-up-static-blog-using-nuxt">《如何使用Nuxt建立个人博客》</a>部署到服务器之后竟然需要一分多钟才能完全加载好，而在开发模式下也就几秒钟就加载好了。</p>\n<p>看来优化网站刻不容缓了。</p>\n<h1><a id="markedhighlightjs_53"></a>博客页移除marked和highlight.js</h1>\n<p>然后我试了下把marked和highlight.js从<code>/blogs/_slug.vue</code>移除，<code>asyncData</code>从API获取内容的部分不变，只是在<code>computed</code>部分减掉了相关处理，然后再次生成静态网页，整个网站代码量立刻轻了很多，如图</p>\n<p><strong>before</strong><br>\n<img src="/img/blogs/2019-05-18/001.png" alt="before" title="before"></p>\n<p><strong>after</strong><br>\n<img src="/img/blogs/2019-05-18/002.png" alt="after" title="after"></p>\n<h1><a id="APIMarkdownHTML_63"></a>在API内添加Markdown转HTML的处理</h1>\n<p>接下来是重头戏了，我们不在博客页渲染Markdown，而是直接在json里获取一个渲染后的HTML，那么这个HTML内容是怎么生成的呢？</p>\n<p>我的<code>/api/index.js</code>现在是这样写的</p>\n<pre><code class="language-javascript">\t<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">"express"</span>);\n\t<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);\n\t<span class="hljs-keyword">var</span> fm = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'front-matter\'</span>);\n\t<span class="hljs-keyword">var</span> app = express();\n\t<span class="hljs-keyword">var</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'marked\'</span>);\n\t<span class="hljs-keyword">var</span> hljs = <span class="hljs-built_in">require</span>(<span class="hljs-string">\'highlight.js\'</span>);\n\n\t<span class="hljs-keyword">var</span> rendererMD = <span class="hljs-keyword">new</span> marked.Renderer();\n\t<span class="hljs-keyword">var</span> htmlResult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentBody</span>) </span>{\n\t\t<span class="hljs-keyword">return</span> marked(contentBody, {\n\t\t\t<span class="hljs-attr">renderer</span>: rendererMD,\n\t\t\t<span class="hljs-attr">gfm</span>: <span class="hljs-literal">true</span>,\n\t\t\t<span class="hljs-attr">tables</span>: <span class="hljs-literal">true</span>,\n\t\t\t<span class="hljs-attr">breaks</span>: <span class="hljs-literal">false</span>,\n\t\t\t<span class="hljs-attr">pedantic</span>: <span class="hljs-literal">false</span>,\n\t\t\t<span class="hljs-attr">sanitize</span>: <span class="hljs-literal">false</span>,\n\t\t\t<span class="hljs-attr">smartLists</span>: <span class="hljs-literal">true</span>,\n\t\t\t<span class="hljs-attr">smartypants</span>: <span class="hljs-literal">false</span>,\n\t\t\t<span class="hljs-attr">highlight</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{\n\t\t\t  <span class="hljs-keyword">return</span> hljs.highlightAuto(code).value\n\t\t\t}\n\t\t})\n\t};\n\n\t<span class="hljs-keyword">var</span> singleBlog = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fullPath, slug, isContentRequired</span>) </span>{\n\t\t<span class="hljs-keyword">var</span> blog = {};\n\t\t<span class="hljs-keyword">var</span> content = fm(fs.readFileSync(fullPath, <span class="hljs-string">"utf8"</span>));\n\t\tblog = content.attributes;\n\t\tblog.slug = slug;\n\t\t<span class="hljs-keyword">if</span> (isContentRequired) {\n\t\t\tblog.content = htmlResult(content.body);<span class="hljs-comment">//从Markdown生成HTML</span>\n\t\t}\n\t\t<span class="hljs-keyword">return</span> blog;\n\t}\n\n\tapp.get(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) </span>{\n\t\t<span class="hljs-comment">// allow cross orign access</span>\n\t\tres.header(<span class="hljs-string">\'Access-Control-Allow-Origin\'</span>, <span class="hljs-string">\'*\'</span>);\n\t\t<span class="hljs-keyword">var</span> path = __dirname + <span class="hljs-string">\'\\\\blogs\'</span>;\n\t\t<span class="hljs-keyword">var</span> files = fs.readdirSync(path);\n\n\t\t<span class="hljs-keyword">var</span> json = {};<span class="hljs-comment">// result to be returned</span>\n\n\t\t<span class="hljs-keyword">var</span> qSlug = req.query.slug || <span class="hljs-string">""</span>;\n\t\t<span class="hljs-keyword">var</span> qImg = req.query.img || <span class="hljs-string">""</span>;\n\t\t<span class="hljs-keyword">var</span> qTag = req.query.tag || <span class="hljs-string">""</span>;\n\t\t<span class="hljs-keyword">if</span> (qSlug) {<span class="hljs-comment">// with blog slug query</span>\n\t\t\tjson = singleBlog(path+<span class="hljs-string">"\\\\"</span>+qSlug+<span class="hljs-string">".md"</span>, qSlug, <span class="hljs-literal">true</span>);\n\t\t} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qImg) {<span class="hljs-comment">// with img query</span>\n\t\t\t...\n\t\t} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (qTag) {<span class="hljs-comment">// with tag query</span>\n\t\t\t...\n\t\t} <span class="hljs-keyword">else</span> {<span class="hljs-comment">//without requirement, returns list of all blogs</span>\n\t\t\t...\n\t\t}\n\t\tres.send(json);\n\t});\n\n\tapp.listen(<span class="hljs-number">4000</span>, () =&gt; {\n\t\t<span class="hljs-built_in">console</span>.log(<span class="hljs-string">"express server running at http://127.0.0.1:4000"</span>)\n\t});\n</code></pre>\n<p>这样API就会返回一个含有渲染后的HTML的json，我的网站就可以直接用啦。</p>\n<p>当然别忘了在博客页引入<code>highlight.js</code>的css，否则好不容易渲染好了HTML，却没了样式，那就不好了。</p>\n<p>API经过这样处理之后，反应时间会变慢，但是比起网站经过优化后而减少的反应时间，那是非常不值一提了。</p>\n<p>以上~</p>\n',prev:s,next:"2019-05-25-takarazuka-musical"},tags:t,date:"2019-05-18",relatedBlog:[{layout:l,title:"如何使用Nuxt建立个人博客",description:"重构了一下博客，从Jekyll迁移到了Nuxt。方法是先用Node API 来解析 Markdown 文件，然后 Nuxt+Axios 获取 API 返回的文章内容并生成静态页面。",tags:["涨知识",e,r,"静态博客"],comments:!0,related_blog:["2018-03-28-set-up-static-blog",n],slug:s,prev:"2018-12-21-Korean-drama-memories-of-the-alhambra-n-feel-good-to-die",next:n,date:"2019-05-05"}],baseURL:"/",ui_str:{to_prev:"上一篇",to_next:"下一篇",related_posts:"相关文章"}}],error:null,serverRendered:!0}}("2019-05-05-set-up-static-blog-using-nuxt",0,"2019-05-18-lighten-nuxt-generated-site-by-removing-marked-and-highlightjs","post",Array(3),0,"JavaScript","Nuxt")</script><script src="/_nuxt/d62a008b225084d4add7.js" defer></script><script src="/_nuxt/b4d4a0baed0e9fb51d3e.js" defer></script><script src="/_nuxt/e538c0d34daa29c0b6a1.js" defer></script><script src="/_nuxt/7c2eafc52e6930abbe67.js" defer></script>
  </body>
</html>
