<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">如何使用Nuxt建立个人博客 | Jenny的小站</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="Node解析Markdown，建立API返回JSON，Nuxt+Axios获取文章内容并生成静态页面"><link data-n-head="true" rel="icon" type="image/x-icon" href="/favicon.ico"><link data-n-head="true" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"><link data-n-head="true" rel="stylesheet" href="/styles.css"><link data-n-head="true" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/3.0.1/github-markdown.min.css"><link data-n-head="true" rel="stylesheet" href="/highlight.js.css"><base href="/"><link rel="preload" href="/_nuxt/a37a3575bbdfb58ce2fa.js" as="script"><link rel="preload" href="/_nuxt/ec0b83a3fb195aad8df5.js" as="script"><link rel="preload" href="/_nuxt/f082d54e40c117ba6759.js" as="script"><link rel="preload" href="/_nuxt/7bf2c47e3d74471fa3ec.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 26f6ee09:0 498b36b5:0 6f6f973d:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}nav[data-v-75342822]{position:fixed;top:0;left:0;right:0;bottom:0;height:40px;box-shadow:0 0 1px 0 rgba(0,0,0,.6);z-index:9999}.nav-wrap[data-v-75342822],nav[data-v-75342822]{background:inherit}.nav-wrap[data-v-75342822]{margin:0 auto;width:800px;display:flex;justify-content:space-between}header[data-v-75342822]{font-family:Gugi,cursive;margin:0 0 0 10px;height:100%;z-index:2}.nav-ul[data-v-75342822],header h2[data-v-75342822]{margin:0;height:100%}header a[data-v-75342822]{text-decoration:none}header a[data-v-75342822]:active,header a[data-v-75342822]:visited{color:inherit}.font-impact[data-v-75342822]{font-family:Impact}.nav-ul[data-v-75342822]{list-style:none;text-align:right;display:flex;justify-content:center;z-index:1}.nav-link[data-v-75342822]{margin-right:20px;height:100%;text-decoration:none}.nav-link[data-v-75342822]:last{margin-right:10px}.nav-link[data-v-75342822]:active{color:inherit}.nav-link li[data-v-75342822],header h2[data-v-75342822]{color:#000;height:100%;line-height:40px}.nav-link li[data-v-75342822]:hover{color:grey}.nav-link[data-v-75342822]:visited{color:inherit}.nuxt-link-active[data-v-75342822]{border-bottom:1px solid #000}.nav-mask[data-v-75342822]{height:40px;background:inherit;z-index:0}.body-mask[data-v-75342822],.nav-mask[data-v-75342822]{position:fixed;width:100%}.body-mask[data-v-75342822]{height:0;transition:height .8s;background:rgba(0,0,0,.5)}.body-mask-visible[data-v-75342822]{height:100%}.nav-btn[data-v-75342822]{width:40px;height:40px;display:none;z-index:2}.bar[data-v-75342822]{width:70%;height:25%;text-align:center;border-bottom:2px solid #000}.bar[data-v-75342822]:last-child{border:none}@media (max-width:425px){.nav-wrap[data-v-75342822]{width:100%}.nav-mask[data-v-75342822]{z-index:1}.nav-ul[data-v-75342822]{position:fixed;margin-top:40px;padding:0;width:100%;height:auto;-webkit-transform:translateY(-100%);transform:translateY(-100%);text-align:left;background:#fff;transition:-webkit-transform .8s;transition:transform .8s;transition:transform .8s,-webkit-transform .8s;display:block;overflow:hidden;z-index:0}.nav-mobile[data-v-75342822]{-webkit-transform:translateY(0);transform:translateY(0)}.nav-link[data-v-75342822]{height:auto}.nav-link li[data-v-75342822]{margin:0 10px;width:auto;height:auto;line-height:20px;border-bottom:1px solid #000}.nav-btn[data-v-75342822],.nav-link li[data-v-75342822]{display:block}}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}.youtube-img{position:relative;display:inline-block}.youtube-img:before{width:40%;height:40%;border-radius:25%;background:red}.youtube-img:after,.youtube-img:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;margin:auto}.youtube-img:after{width:0;height:0;border-top:10px solid transparent;border-left:20px solid #fff;border-bottom:10px solid transparent}footer[data-v-759117da]{border-top:1px solid rgba(0,0,0,.6)}p[data-v-759117da]{margin:20px auto;font-size:14px;text-align:center}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav data-v-75342822><div class="nav-wrap" data-v-75342822><header data-v-75342822><a href="/" class="no-decor" data-v-75342822><h2 data-v-75342822>Jenny's blog</h2></a></header> <div class="nav-btn" data-v-75342822><div class="bar" data-v-75342822></div> <div class="bar" data-v-75342822></div> <div class="bar" data-v-75342822></div> <div class="bar" data-v-75342822></div></div> <div class="nav-mask" data-v-75342822></div> <div class="body-mask" data-v-75342822></div> <ul class="nav-ul" data-v-75342822><a href="/about" class="nav-link" data-v-75342822><li data-v-75342822>About</li></a><a href="/blogs" class="nav-link" data-v-75342822><li data-v-75342822>Blogs</li></a></ul></div></nav> <main><div><h1>如何使用Nuxt建立个人博客</h1> <p class="blog-date">2019-05-05</p> <p class="blog-date">
    Tags: 
    <span class="blog-tag"><a href="/blogs/tag/涨知识">涨知识</a></span><span class="blog-tag"><a href="/blogs/tag/Nuxt">Nuxt</a></span></p> <div class="blog-desc">Node解析Markdown，建立API返回JSON，Nuxt+Axios获取文章内容并生成静态页面</div> <div class="markdown-body"><h2 id="nuxt是什么？">Nuxt是什么？</h2>
<blockquote>
<p>Nuxt.js 是一个基于Vue.js 的轻量级应用框架，可用来创建服务端渲染(SSR) 应用，也可充当静态站点引擎生成静态站点应用，具有优雅的代码结构分层和热加载等优势。</p>
</blockquote>
<h2 id="为什么要从jekyll转成nuxt？">为什么要从Jekyll转成Nuxt？</h2>
<p>其实也没啥原因，就是想自己做个网站试试。</p>
<p>之前用的Jekyll模板是别人做的，自己就算想做点个性化设置也无从下手。</p>
<p>况且Jekyll是用Ruby写的，自从上次尝试安装Ruby失败之后，我就对Jekyll失望了。</p>
<p>因为没能安装Ruby，我也从来没能在本机上预览我的博客，只能是部署到GitHub之后才能看到成果，所以就更加失望了。</p>
<p>之前某行业大佬推荐说，可以试着用Nuxt做网站，因为Nuxt是基于Vue的框架，而我正好除了Vue之外啥也不会，所以应该适合我。</p>
<p>于是就开始整了。</p>
<h2 id="准备工作和建立博客的探索">准备工作和建立博客的探索</h2>
<p>在实际开始做事之前，我先看了以下的Youtube教学视频，每一个都翻来覆去看了两三遍</p>
<p>Youtube视频教程：使用Nuxt(框架)和storyblok(基于api提供内容的CMS)建立个人博客</p>
<p><a target="_blank" href="https://www.youtube.com/watch?v=Dc_5BpIB4X4" title="The Front-End | Nuxt.js & Storyblok - Building a Complete Blog"><span class="youtube-img"><img src="https://i.ytimg.com/vi/Dc_5BpIB4X4/default.jpg" alt="youtube-img"></span></a>
<a target="_blank" href="https://www.youtube.com/watch?v=UIh4P5rNjac" title="Adding Storyblok CMS | Nuxt.js & Storyblok - Building a Complete Blog"><span class="youtube-img"><img src="https://i.ytimg.com/vi/UIh4P5rNjac/default.jpg" alt="youtube-img"></span></a>
<a target="_blank" href="https://www.youtube.com/watch?v=Yq6Ddu_QAiY" title="Storyblok Live Preview! | Nuxt.js & Storyblok - Building a Complete Blog"><span class="youtube-img"><img src="https://i.ytimg.com/vi/Yq6Ddu_QAiY/default.jpg" alt="youtube-img"></span></a>
<a target="_blank" href="https://www.youtube.com/watch?v=JHCKab2oS4s" title="Final Touches & Deploying the Blog | Nuxt.js & Storyblok - Building a Complete Blog"><span class="youtube-img"><img src="https://i.ytimg.com/vi/JHCKab2oS4s/default.jpg" alt="youtube-img"></span></a></p>
<p>视频的主要内容是使用Nuxt建立博客首页（文章列表页）、附属页面，建立页面导航路由，然后在博客详情页用Axios加载api传来的文章内容，最后生成静态网站。</p>
<p>除了storyblok之外还有contentful等提供内容管理的网站，但是我不想依赖外部内容资源，也不想注册这些网站，于是就只是照着视频先起了个项目，写了些components和layout，然后建立了几个page。</p>
<p>其实也就三个：index.vue, about.vue, blogs.vue。</p>
<p>然后发现了另外一个Youtube视频教程：使用Nuxt生成静态网站<br><a target="_blank" href="https://www.youtube.com/watch?v=pI2qHPI0ZpU" title="Nuxt.js - Static Site Generator"><span class="youtube-img"><img src="https://i.ytimg.com/vi/pI2qHPI0ZpU/default.jpg" alt="youtube-img"></span></a></p>
<p>这一个视频的主要内容是不使用外部资源，博客文章页也用.vue的文件书写，最后生成静态网站。</p>
<p>但是我不想专门给每一篇文章都开一个.vue的文件，这样不好管理，没法在其他地方复用，也不能导入别的项目的Markdown文章。</p>
<p>于是我在google上搜索如何让Nuxt使用Markdown文件作为资源生成静态博客，然后找到一个Nuxt官方团队的github issue<br><a target="_blank" href="https://github.com/nuxt/nuxt.js/issues/396">Using markdown as articles?</a></p>
<p>题主说自己在Nuxt项目之外开了个api，以作返回Markdown文章内容之用，而楼内有个Nuxt官方成员回复说，可能考虑在Nuxt项目内添加一个叫作“serverMiddleware”的东西，这样就不用去另外开api来返回文章内容了。</p>
<p>这个issue是2017年的，我希望这么久的时间足够他们添加这个feature，于是又去搜“Nuxt serverMiddleware”，果然有结果，非常让人惊喜。</p>
<p>然后我又看了这个Youtube视频：手把手教你在Nuxt项目中使用serverMiddleware<br><a target="_blank" href="https://www.youtube.com/watch?v=j-3RwvWZoaU" title="Why You Should Learn Server Middleware with Nuxt.js! A step-by-step tutorial!"><span class="youtube-img"><img src="https://i.ytimg.com/vi/j-3RwvWZoaU/default.jpg" alt="youtube-img"></span></a></p>
<p>这个视频教了一下serverMiddleware的api路径配置，以及api的服务端代码怎么写。</p>
<p>用了serverMiddleware之后，就能在开发模式下使用这个api接口了。</p>
<p>于是我在项目内新增一个api的文件夹，里面摆放我旧博客里的Markdown文章，然后用api去做解析。</p>
<p>但是这样也有一个问题，api的服务端代码还没完全写好的时候，需要经常中断进程，修改完代码之后再重新开启。可是npm run dev一次就要好几分钟，而我可能就只是改了几个变量名，这样实在是太低效了。</p>
<p>而且在npm run generate生成静态网站的时候，如果这个api没有处于运行状态，是无法返回文章内容的。可是如果这边开一个终端运行开发模式，那边又开一个终端生成静态页面的话，两边都会报很多错，一行一行的红色警告吓死人。</p>
<p>于是我只好放弃serverMiddleware，让这个api单独去运行。</p>
<p>Nuxt项目在开发模式下是在localhost:3000上运行，而这个api则是在127.0.0.1:4000上，在项目运行开发模式之前先把api启动，调试完了关闭开发模式，然后生成静态页面，完了之后再把api关掉。</p>
<p>这样就成了。</p>
<h2 id="收获">收获</h2>
<p>前前后后花了两个多星期，我的博客终于有了新面貌，然而在这个过程中最惊喜的还是Youtube，想找什么样的教学视频都有。</p>
<p>而且它自动生成的字幕非常有用，各个国家千奇百怪的口音竟然都能识别出来，即使不是100%匹配，也能让我这个非英语母语的人跟上视频博主的思路。</p>
<p>在这里给Youtube点个赞！</p>
<h2 id="小插曲">小插曲</h2>
<p>本来页面导航栏和各种链接应该要使用<code>&lt;nuxt-link/></code>标签的，这样就可以用Nuxt的路由机制，加快访问速度。</p>
<p>但是它有一个问题是，在最终生成的静态网站上使用路由访问的时候，页面仍然会去请求127.0.0.1:4000上的内容，可是这时候api已经关闭了，请求失败之后页面就会来个“Network error”，可是如果使用URL去访问，又是可以加载出内容的。</p>
<p>所以我不得不忍痛割爱，把所有<code>&lt;nuxt-link/></code>的链接都换成了普通的<code>&lt;a>&lt;/a></code>标签的链接，这样静态网站就可以正常使用了。</p>
<h2 id="项目结构">项目结构</h2>
<pre><code>myblog
├─ <span class="hljs-selector-class">.nuxt</span>
├─ api    <span class="hljs-comment">//☆手动建立这个文件夹☆</span>
│   ├─ blogs    <span class="hljs-comment">//需要api解析的Markdown文件夹</span>
│   │   ├─ <span class="hljs-number">2019</span>-<span class="hljs-number">05</span>-<span class="hljs-number">05</span>-set-up-static-blog-using-nuxt<span class="hljs-selector-class">.md</span>
│   │   ├─ <span class="hljs-number">2017</span>-<span class="hljs-number">05</span>-<span class="hljs-number">28</span>-hao123-issue<span class="hljs-selector-class">.md</span>
│   │   └─ ...
│   └─ index<span class="hljs-selector-class">.js</span> <span class="hljs-comment">//api的入口，一个 node index.js 就跑起来了</span>
│               <span class="hljs-comment">//默认路径http://127.0.0.1:4000</span>
├─ components
│   ├─ Carousel<span class="hljs-selector-class">.vue</span>
│   ├─ Footer<span class="hljs-selector-class">.vue</span>
│   └─ Navigation<span class="hljs-selector-class">.vue</span>
├─ dist        <span class="hljs-comment">//☆最后生成的静态文件都在这里☆</span>
├─ layouts
│   ├─ default<span class="hljs-selector-class">.vue</span> <span class="hljs-comment">//Navigation + Nuxt(主要内容) + Footer</span>
│   └─ error<span class="hljs-selector-class">.vue</span> <span class="hljs-comment">//虽然按要求弄了error页面，可是找不到页面时还是</span>
│                <span class="hljs-comment">//跳去服务器(github)的404页，求大神指点</span>
├─ pages
│   ├─ blogs
│   │   ├─ tag
│   │   │   ├─ _tag<span class="hljs-selector-class">.vue</span>  <span class="hljs-comment">//动态渲染标签下的文章列表</span>
│   │   │   │            <span class="hljs-comment">// => /blogs/tag/aaa.html</span>
│   │   │   └─ index<span class="hljs-selector-class">.vue</span> <span class="hljs-comment">//文章标签页 => /blogs/tag.html</span>
│   │   ├─ _slug<span class="hljs-selector-class">.vue</span> <span class="hljs-comment">//动态渲染文章页面 </span>
│   │   │            <span class="hljs-comment">// => /blogs/2019~~.html</span>
│   │   └─ index<span class="hljs-selector-class">.vue</span> <span class="hljs-comment">//文章列表页 => /blogs.html</span>
│   ├─ about<span class="hljs-selector-class">.vue</span>
│   └─ index<span class="hljs-selector-class">.vue</span>     <span class="hljs-comment">//网站入口 => /index.html</span>
├─ static
│   ├─ <span class="hljs-selector-tag">img</span>
│   │   └─ home  <span class="hljs-comment">//首页用图 </span>
│   │       ├─ pic1<span class="hljs-selector-class">.jpg</span> <span class="hljs-comment">// => /img/home/bird1.jpg</span>
│   │       └─ pic2<span class="hljs-selector-class">.jpg</span> <span class="hljs-comment">// => /img/home/bird2.jpg</span>
│   ├─ favicon<span class="hljs-selector-class">.ico</span>  <span class="hljs-comment">//网站图标 => /favicon.ico</span>
│   └─ styles<span class="hljs-selector-class">.css</span>   <span class="hljs-comment">//公用css => /styles.css</span>
│
├─ myConfig<span class="hljs-selector-class">.js</span> <span class="hljs-comment">//一些自定义设置，用export default导出</span>
│              <span class="hljs-comment">//☆自己建立的，方便项目使用☆</span>
│              <span class="hljs-comment">//可以导入到vue文件中使用</span>
│
├─ nuxt<span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.js</span> <span class="hljs-comment">//nuxt网站整体设置，用module.exports导出</span>
│                 <span class="hljs-comment">//☆网站baseURL等设置全都在这里☆</span>
│                 <span class="hljs-comment">//无法被导入到vue文件中使用</span>
├─ ...   <span class="hljs-comment">//其他文件没动过</span></code></pre><h2 id="搭建网站的要点">搭建网站的要点</h2>
<ol>
<li><p>在/api/文件夹内打开一个终端，用 node index.js 启动api，解析/api/blogs/文件夹内的Markdown文件，返回一个JSON，这个api在开发调试和生成静态页面过程中都需要保持开启状态。<br>这个api可以：    </p>
<ol>
<li>请求时不加参数则返回所有文章列表</li>
<li>请求时加参数slug则返回特定文章内容</li>
<li>请求时加参数tag则返回特定tag下的文章列表</li>
</ol>
</li>
<li><p>在components组件文件夹内建立Navigation.vue和Footer.vue，在layouts布局文件夹的default.vue里组合起来</p>
</li>
<li><p>根目录下建立index.vue、about.vue和blogs文件夹，里面新建index.vue和_slug.vue两个文件。以下划线开头的vue文件会被Nuxt解析为动态路由，当用户在浏览器里访问符合路径规则的页面地址时就会渲染出相应的页面。</p>
</li>
<li><p>在/blogs/index.vue里面需要用Axios获取api返回的JSON数据</p>
<pre><code class="language-javascript"> <span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
 <span class="hljs-keyword">import</span> myConfig <span class="hljs-keyword">from</span> <span class="hljs-string">"../../myConfig"</span>;
 <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
   asyncData({ params }) {
     <span class="hljs-keyword">return</span> axios.get(<span class="hljs-string">'http://127.0.0.1:4000?slug='</span>+params.slug).then(<span class="hljs-function"><span class="hljs-params">res</span> =></span> {
       <span class="hljs-keyword">let</span> blog = res.data;
       <span class="hljs-keyword">let</span> space = [];
       <span class="hljs-keyword">let</span> tags = blog.tags || [<span class="hljs-string">'none'</span>];
       <span class="hljs-keyword">return</span> {
         <span class="hljs-attr">blog</span>: blog,
         <span class="hljs-attr">tags</span>: tags,
         <span class="hljs-attr">date</span>: params.slug.substring(<span class="hljs-number">0</span>,<span class="hljs-number">10</span>),
         <span class="hljs-attr">baseURL</span>: myConfig.baseURL
       };
     })
   }
   ...
 }</code></pre>
</li>
</ol>
<p>待续。。。</p>
</div> <div id="disqus_thread"></div></div></main> <footer data-v-759117da><p data-v-759117da>Created by <strong data-v-759117da>Jenny HOU</strong>.</p></footer></div></div></div><script>window.__NUXT__=function(r){return r[0]="涨知识",r[1]="Nuxt",{layout:"default",data:[{blog:{layout:"post",title:"如何使用Nuxt建立个人博客",description:"Node解析Markdown，建立API返回JSON，Nuxt+Axios获取文章内容并生成静态页面",tags:r,slug:"2019-05-05-set-up-static-blog-using-nuxt",content:"## Nuxt是什么？\r\n\r\n>Nuxt.js 是一个基于Vue.js 的轻量级应用框架，可用来创建服务端渲染(SSR) 应用，也可充当静态站点引擎生成静态站点应用，具有优雅的代码结构分层和热加载等优势。\r\n\r\n## 为什么要从Jekyll转成Nuxt？\r\n\r\n其实也没啥原因，就是想自己做个网站试试。\r\n\r\n之前用的Jekyll模板是别人做的，自己就算想做点个性化设置也无从下手。\r\n\r\n况且Jekyll是用Ruby写的，自从上次尝试安装Ruby失败之后，我就对Jekyll失望了。\r\n\r\n因为没能安装Ruby，我也从来没能在本机上预览我的博客，只能是部署到GitHub之后才能看到成果，所以就更加失望了。\r\n\r\n之前某行业大佬推荐说，可以试着用Nuxt做网站，因为Nuxt是基于Vue的框架，而我正好除了Vue之外啥也不会，所以应该适合我。\r\n\r\n于是就开始整了。\r\n\r\n## 准备工作和建立博客的探索\r\n\r\n在实际开始做事之前，我先看了以下的Youtube教学视频，每一个都翻来覆去看了两三遍\r\n\r\nYoutube视频教程：使用Nuxt(框架)和storyblok(基于api提供内容的CMS)建立个人博客\r\n\r\n[![youtube-img](https://i.ytimg.com/vi/Dc_5BpIB4X4/default.jpg)](https://www.youtube.com/watch?v=Dc_5BpIB4X4 'The Front-End | Nuxt.js & Storyblok - Building a Complete Blog')\r\n[![youtube-img](https://i.ytimg.com/vi/UIh4P5rNjac/default.jpg)](https://www.youtube.com/watch?v=UIh4P5rNjac 'Adding Storyblok CMS | Nuxt.js & Storyblok - Building a Complete Blog')\r\n[![youtube-img](https://i.ytimg.com/vi/Yq6Ddu_QAiY/default.jpg)](https://www.youtube.com/watch?v=Yq6Ddu_QAiY 'Storyblok Live Preview! | Nuxt.js & Storyblok - Building a Complete Blog')\r\n[![youtube-img](https://i.ytimg.com/vi/JHCKab2oS4s/default.jpg)](https://www.youtube.com/watch?v=JHCKab2oS4s 'Final Touches & Deploying the Blog | Nuxt.js & Storyblok - Building a Complete Blog')\r\n\r\n视频的主要内容是使用Nuxt建立博客首页（文章列表页）、附属页面，建立页面导航路由，然后在博客详情页用Axios加载api传来的文章内容，最后生成静态网站。\r\n\r\n除了storyblok之外还有contentful等提供内容管理的网站，但是我不想依赖外部内容资源，也不想注册这些网站，于是就只是照着视频先起了个项目，写了些components和layout，然后建立了几个page。\r\n\r\n其实也就三个：index.vue, about.vue, blogs.vue。\r\n\r\n然后发现了另外一个Youtube视频教程：使用Nuxt生成静态网站    \r\n[![youtube-img](https://i.ytimg.com/vi/pI2qHPI0ZpU/default.jpg)](https://www.youtube.com/watch?v=pI2qHPI0ZpU 'Nuxt.js - Static Site Generator')\r\n\r\n这一个视频的主要内容是不使用外部资源，博客文章页也用.vue的文件书写，最后生成静态网站。\r\n\r\n但是我不想专门给每一篇文章都开一个.vue的文件，这样不好管理，没法在其他地方复用，也不能导入别的项目的Markdown文章。\r\n\r\n于是我在google上搜索如何让Nuxt使用Markdown文件作为资源生成静态博客，然后找到一个Nuxt官方团队的github issue    \r\n[Using markdown as articles?](https://github.com/nuxt/nuxt.js/issues/396)\r\n\r\n题主说自己在Nuxt项目之外开了个api，以作返回Markdown文章内容之用，而楼内有个Nuxt官方成员回复说，可能考虑在Nuxt项目内添加一个叫作“serverMiddleware”的东西，这样就不用去另外开api来返回文章内容了。\r\n\r\n这个issue是2017年的，我希望这么久的时间足够他们添加这个feature，于是又去搜“Nuxt serverMiddleware”，果然有结果，非常让人惊喜。\r\n\r\n然后我又看了这个Youtube视频：手把手教你在Nuxt项目中使用serverMiddleware    \r\n[![youtube-img](https://i.ytimg.com/vi/j-3RwvWZoaU/default.jpg)](https://www.youtube.com/watch?v=j-3RwvWZoaU 'Why You Should Learn Server Middleware with Nuxt.js! A step-by-step tutorial!')\r\n\r\n这个视频教了一下serverMiddleware的api路径配置，以及api的服务端代码怎么写。\r\n\r\n用了serverMiddleware之后，就能在开发模式下使用这个api接口了。\r\n\r\n于是我在项目内新增一个api的文件夹，里面摆放我旧博客里的Markdown文章，然后用api去做解析。\r\n\r\n但是这样也有一个问题，api的服务端代码还没完全写好的时候，需要经常中断进程，修改完代码之后再重新开启。可是npm run dev一次就要好几分钟，而我可能就只是改了几个变量名，这样实在是太低效了。\r\n\r\n而且在npm run generate生成静态网站的时候，如果这个api没有处于运行状态，是无法返回文章内容的。可是如果这边开一个终端运行开发模式，那边又开一个终端生成静态页面的话，两边都会报很多错，一行一行的红色警告吓死人。\r\n\r\n于是我只好放弃serverMiddleware，让这个api单独去运行。\r\n\r\nNuxt项目在开发模式下是在localhost:3000上运行，而这个api则是在127.0.0.1:4000上，在项目运行开发模式之前先把api启动，调试完了关闭开发模式，然后生成静态页面，完了之后再把api关掉。\r\n\r\n这样就成了。\r\n\r\n## 收获\r\n\r\n前前后后花了两个多星期，我的博客终于有了新面貌，然而在这个过程中最惊喜的还是Youtube，想找什么样的教学视频都有。\r\n\r\n而且它自动生成的字幕非常有用，各个国家千奇百怪的口音竟然都能识别出来，即使不是100%匹配，也能让我这个非英语母语的人跟上视频博主的思路。\r\n\r\n在这里给Youtube点个赞！\r\n\r\n## 小插曲\r\n\r\n本来页面导航栏和各种链接应该要使用```<nuxt-link/>```标签的，这样就可以用Nuxt的路由机制，加快访问速度。\r\n\r\n但是它有一个问题是，在最终生成的静态网站上使用路由访问的时候，页面仍然会去请求127.0.0.1:4000上的内容，可是这时候api已经关闭了，请求失败之后页面就会来个“Network error”，可是如果使用URL去访问，又是可以加载出内容的。\r\n\r\n所以我不得不忍痛割爱，把所有```<nuxt-link/>```的链接都换成了普通的```<a></a>```标签的链接，这样静态网站就可以正常使用了。\r\n\r\n## 项目结构\r\n\r\n```\r\nmyblog\r\n├─ .nuxt\r\n├─ api    //☆手动建立这个文件夹☆\r\n│   ├─ blogs    //需要api解析的Markdown文件夹\r\n│   │   ├─ 2019-05-05-set-up-static-blog-using-nuxt.md\r\n│   │   ├─ 2017-05-28-hao123-issue.md\r\n│   │   └─ ...\r\n│   └─ index.js //api的入口，一个 node index.js 就跑起来了\r\n│               //默认路径http://127.0.0.1:4000\r\n├─ components\r\n│   ├─ Carousel.vue\r\n│   ├─ Footer.vue\r\n│   └─ Navigation.vue\r\n├─ dist        //☆最后生成的静态文件都在这里☆\r\n├─ layouts\r\n│   ├─ default.vue //Navigation + Nuxt(主要内容) + Footer\r\n│   └─ error.vue //虽然按要求弄了error页面，可是找不到页面时还是\r\n│                //跳去服务器(github)的404页，求大神指点\r\n├─ pages\r\n│   ├─ blogs\r\n│   │   ├─ tag\r\n│   │   │   ├─ _tag.vue  //动态渲染标签下的文章列表\r\n│   │   │   │            // => /blogs/tag/aaa.html\r\n│   │   │   └─ index.vue //文章标签页 => /blogs/tag.html\r\n│   │   ├─ _slug.vue //动态渲染文章页面 \r\n│   │   │            // => /blogs/2019~~.html\r\n│   │   └─ index.vue //文章列表页 => /blogs.html\r\n│   ├─ about.vue\r\n│   └─ index.vue     //网站入口 => /index.html\r\n├─ static\r\n│   ├─ img\r\n│   │   └─ home  //首页用图 \r\n│   │       ├─ pic1.jpg // => /img/home/bird1.jpg\r\n│   │       └─ pic2.jpg // => /img/home/bird2.jpg\r\n│   ├─ favicon.ico  //网站图标 => /favicon.ico\r\n│   └─ styles.css   //公用css => /styles.css\r\n│\r\n├─ myConfig.js //一些自定义设置，用export default导出\r\n│              //☆自己建立的，方便项目使用☆\r\n│              //可以导入到vue文件中使用\r\n│\r\n├─ nuxt.config.js //nuxt网站整体设置，用module.exports导出\r\n│                 //☆网站baseURL等设置全都在这里☆\r\n│                 //无法被导入到vue文件中使用\r\n├─ ...   //其他文件没动过\r\n```\r\n\r\n## 搭建网站的要点\r\n\r\n1. 在/api/文件夹内打开一个终端，用 node index.js 启动api，解析/api/blogs/文件夹内的Markdown文件，返回一个JSON，这个api在开发调试和生成静态页面过程中都需要保持开启状态。    \r\n这个api可以：    \r\n\t1. 请求时不加参数则返回所有文章列表\r\n\t2. 请求时加参数slug则返回特定文章内容\r\n\t3. 请求时加参数tag则返回特定tag下的文章列表\r\n\r\n2. 在components组件文件夹内建立Navigation.vue和Footer.vue，在layouts布局文件夹的default.vue里组合起来\r\n\r\n3. 根目录下建立index.vue、about.vue和blogs文件夹，里面新建index.vue和_slug.vue两个文件。以下划线开头的vue文件会被Nuxt解析为动态路由，当用户在浏览器里访问符合路径规则的页面地址时就会渲染出相应的页面。\r\n\r\n4. 在/blogs/index.vue里面需要用Axios获取api返回的JSON数据\r\n```javascript\r\n\timport axios from 'axios'\r\n\timport myConfig from \"../../myConfig\";\r\n\texport default {\r\n\t  asyncData({ params }) {\r\n\t    return axios.get('http://127.0.0.1:4000?slug='+params.slug).then(res => {\r\n\t      let blog = res.data;\r\n\t      let space = [];\r\n\t      let tags = blog.tags || ['none'];\r\n\t      return {\r\n\t        blog: blog,\r\n\t        tags: tags,\r\n\t        date: params.slug.substring(0,10),\r\n\t        baseURL: myConfig.baseURL\r\n\t      };\r\n\t    })\r\n\t  }\r\n\t  ...\r\n\t}\r\n```\r\n\r\n待续。。。"},tags:r,date:"2019-05-05",baseURL:"/"}],error:null,serverRendered:!0}}(Array(2))</script><script src="/_nuxt/a37a3575bbdfb58ce2fa.js" defer></script><script src="/_nuxt/7bf2c47e3d74471fa3ec.js" defer></script><script src="/_nuxt/ec0b83a3fb195aad8df5.js" defer></script><script src="/_nuxt/f082d54e40c117ba6759.js" defer></script>
  </body>
</html>
