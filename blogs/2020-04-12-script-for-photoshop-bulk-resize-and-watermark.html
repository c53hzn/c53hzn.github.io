<!doctype html>
<html data-n-head-ssr data-n-head="">
  <head data-n-head="">
    <title data-n-head="true">用JavaScript写一个Photoshop批处理脚本 | Jenny的小站</title><meta data-n-head="true" charset="utf-8"><meta data-n-head="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-n-head="true" data-hid="description" name="description" content="我攒了一个可以在Photoshop里批量调整图像大小和画布大小、添加水印、另存为的JavaScript脚本，又学到了不少东西。"><meta data-n-head="true" data-hid="keyword" name="keyword" content="涨知识, JavaScript, Photoshop, 批处理"><link data-n-head="true" rel="icon" type="image/x-icon" href="/img/favicon.ico"><link data-n-head="true" rel="stylesheet" href="/css/font-gugi.css"><link data-n-head="true" rel="stylesheet" href="/css/font-poppins.css"><link data-n-head="true" rel="stylesheet" href="/css/style.css?2020-04-12"><link data-n-head="true" rel="stylesheet" href="/font-awesome/css/font-awesome.min.css"><link data-n-head="true" rel="stylesheet" href="/css/github-markdown.min.css"><link data-n-head="true" rel="stylesheet" href="/css/highlight.js.css"><link data-n-head="true" rel="stylesheet" href="https://hzn-website.000webhostapp.com/disqus/dist/iDisqus.min.css"><script data-n-head="true" src="/js/statcounter.js"></script><base href="/"><link rel="preload" href="/_nuxt/d62a008b225084d4add7.js" as="script"><link rel="preload" href="/_nuxt/e538c0d34daa29c0b6a1.js" as="script"><link rel="preload" href="/_nuxt/7c2eafc52e6930abbe67.js" as="script"><link rel="preload" href="/_nuxt/b4d4a0baed0e9fb51d3e.js" as="script"><style data-vue-ssr-id="17cfdfa9:0 498b36b5:0 1bd5369a:0">.nuxt-progress{position:fixed;top:0;left:0;right:0;height:2px;width:0;opacity:1;transition:width .1s,opacity .4s;background-color:#3b8070;z-index:999999}.nuxt-progress.nuxt-progress-notransition{transition:none}.nuxt-progress-failed{background-color:red}.markdown-body{margin-bottom:50px}.markdown-body img{max-height:100px}a[id]{position:relative;top:-40px;display:block}a#comment-link{top:0}.blog-desc{margin:10px;padding:10px;color:#666;background-color:rgba(0,0,0,.025)}.youtube-img{position:relative;display:inline-block}.youtube-img:before{width:40%;height:40%;border-radius:25%;background:rgba(0,0,0,.7);transition:background .2s}.youtube-img:after,.youtube-img:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;margin:auto}.youtube-img:after{width:0;height:0;border-top:10px solid transparent;border-left:20px solid #fff;border-bottom:10px solid transparent}.youtube-img:hover:before{background:red}#disqus_thread{margin-top:20px}.prev-next{margin:20px auto;display:block}.prev-next:after{display:table;content:" ";clear:both}.prev-next a{display:inline}.next,.prev{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;margin:20px auto;width:100%;color:grey;border:1px solid grey;cursor:pointer}.prev{width:48%;text-align:left;float:left}.next{width:48%;text-align:right;float:right}.next:hover,.prev:hover{color:#000;border-color:#000}.prev p{padding-left:16px}.next p,.prev p{margin:0;padding-top:16px;padding-bottom:16px}.next p{padding-right:16px}#comment{margin-top:40px}.blog-gallery{margin:20px auto;display:flex;justify-content:center;flex-wrap:wrap;overflow:hidden}.blog-gallery-unit{margin:40px 10px 0;width:46%;border:1px solid silver;border-radius:5px}.blog-gallery-unit:first-child,.blog-gallery-unit:nth-child(2){margin-top:20px}.blog-gallery-unit:hover{border-color:#000}.blog-gallery-inner{padding:21px 10px 10px;height:100%}.blog-gallery-inner h4{margin-top:0;max-height:42px;overflow:hidden}.blog-gallery-desc{line-height:21px;max-height:64px;display:block;overflow:hidden}.blog-gallery-tag{margin:1px;padding:0 8px;color:#fff;font-size:12px;font-family:Microsoft Yahei;line-height:20px;border-radius:999px;background:grey;display:inline-block}@media (max-width:425px){.blog-gallery-unit{width:100%}}</style>
  </head>
  <body data-n-head="">
    <div data-server-rendered="true" id="__nuxt"><!----><div id="__layout"><div class="container"><nav><div class="nav-wrap"><header><a href="/" class="no-decor-link"><p class="nav-home">Jenny's blog</p></a></header> <div class="nav-btn"><div class="bar"></div> <div class="bar"></div> <div class="bar"></div> <div class="bar"></div></div> <div class="nav-mask"></div> <div class="body-mask"></div> <ul class="nav-ul"><a href="/" target="_self" class="nav-link"><li>首页<!----><!----></li></a><a href="/resume" target="_self" class="nav-link"><li>简历<!----><!----></li></a><a href="/blogs" target="_self" class="nav-link nuxt-link-active"><li>博客<!----><!----></li></a><a href="https://wj.qq.com/s2/3731207/f0cd/" target="_blank" class="nav-link"><li>联系我<span> </span><i class="fa fa-external-link"></i></li></a></ul></div></nav> <main><div><section class="main-content"><h1 class="align-center">用JavaScript写一个Photoshop批处理脚本</h1> <p class="blog-date align-center"><span class="fa fa-calendar"> 2020-04-12</span></p> <p class="blog-tags align-center"><a href="/blogs/tag/涨知识"><span class="blog-tag">涨知识</span></a><a href="/blogs/tag/JavaScript"><span class="blog-tag">JavaScript</span></a><a href="/blogs/tag/Photoshop"><span class="blog-tag">Photoshop</span></a><a href="/blogs/tag/批处理"><span class="blog-tag">批处理</span></a></p> <div class="blog-desc">我攒了一个可以在Photoshop里批量调整图像大小和画布大小、添加水印、另存为的JavaScript脚本，又学到了不少东西。</div> <article class="markdown-body"><p></p><h3> </h3><ul><li><a href="blogs/2020-04-12-script-for-photoshop-bulk-resize-and-watermark#_JavaScript__Photoshop__1">用 JavaScript 写 Photoshop 批处理脚本的契机</a></li><li><a href="blogs/2020-04-12-script-for-photoshop-bulk-resize-and-watermark#_JavaScript__15">网上搜到可参考的 JavaScript 脚本</a></li><li><a href="blogs/2020-04-12-script-for-photoshop-bulk-resize-and-watermark#_28">改写成适合我自己情况的脚本</a></li><li><a href="blogs/2020-04-12-script-for-photoshop-bulk-resize-and-watermark#_147">心得体会</a></li></ul><p></p>
<h1><a id="_JavaScript__Photoshop__1"></a>用 JavaScript 写 Photoshop 批处理脚本的契机</h1>
<p>最近需要给一批图片加水印，用 Photoshop 手动做了三张之后我就开始琢磨能不能用一些技术手段来加快处理。</p>
<p>以前处理图片的时候用过 <code>动作（Actions）</code>，这样可以一键完成多步重复性动作，比如调整图像大小和画布大小，然后置入水印图片、合并图层、保存到另一文件夹，这都是可以做到的。</p>
<p>但是 <code>动作</code> 的局限性在于无法根据要处理的图片的形状和尺寸来决定调整图像大小和画布大小的方式，而我要处理的图片就没有形状一样的，有的要以宽度为基准来缩放，有的要以高度为基准来缩放，这样第一步就错了，后面也就没有意义了。</p>
<p>于是我在 Google 上搜索相关信息，看看 <code>动作</code> 有没有个性化设置的可能，然后发现是可以的，但是能用来判断的条件还是太少了，不符合我的要求。</p>
<p>接着就看到有人说，可以试一下用 <code>脚本（Scripts）</code> 来处理，于是又研究了下，发现 Photoshop 接受三种语言写成的脚本： <code>AppleScript</code>、<code>JavaScript</code> 和 <code>VBScript</code>。</p>
<p>这不是巧了嘛！天下脚本千千万，JavaScript南波湾！那我们就开始抄，哦不，开始学吧！</p>
<h1><a id="_JavaScript__15"></a>网上搜到可参考的 JavaScript 脚本</h1>
<p>我在 Google 上搜到 3 个可用的用 JavaScript 写成的 Photoshop 脚本：</p>
<ol>
<li><a href="https://ricardomoinhos.com/photoshop-scripting/" title="Photoshop Scripting – Batch resizing image size and image canvas">Photoshop脚本——批量调整图像大小和画布大小</a><br>
这个脚本主要写的是指定一个源文件夹和目标文件夹，经过一番处理之后把源文件夹里的图片保存到目标文件夹里。他的一番处理里面包括了图像大小和画布大小，这些改一改就可以用了。</li>
<li><a href="http://www.mouseprints.net/old/dpr/PlaceWatermark.jsx" title="JJMack's PlaceWatermark">JJMack的置入水印脚本</a><br>
这个脚本写的是怎么加水印和调整水印在图片上的位置，由于我要加的水印尺寸和最终需要的画布大小一致，也不需要调整位置，所以有些步骤就删掉了。</li>
<li><a href="https://community.adobe.com/t5/photoshop/help-need-a-script-to-merge-all-layers-even-if-there-is-only-one-layer/td-p/3301907?page=1" title="Merge all visible layers">合并所有可见图层</a><br>
我需要一个“合并所有图层”的写法，所以也参考了这个帖子。Photoshop脚本的默认功能里面好像只有“合并所有可见图层”，但是因为这次的操作不会用到隐藏图层，所以这样应该就够了。</li>
</ol>
<p>有以上 3 个脚本，基本上就满足我的需求了。</p>
<h1><a id="_28"></a>改写成适合我自己情况的脚本</h1>
<p>其实我要对图片进行的处理很简单，根据图片的形状，把它的图像大小按比例缩放成不超过 <code>1333 x 1000 px</code> 的尺寸，然后扩展画布大小变成 <code>1600 x 1200 px</code> 的尺寸，然后再把一个 <code>1600 x 1200 px</code> 的水印图片导入进来，合并水印图层和背景图层，另存进一个新的文件夹，完事。</p>
<p>如果手动操作，差不多30秒可以完成一张图，但是如果用代码，不仅能提高速度，还可以解放我的双手，有这时间多刷刷微博也是好的呀。</p>
<p>需要注意的是 Photoshop 用的 JS 代码需要保存成 <code>.jsx</code> 格式的文件，使用时点击 <code>文件 > 脚本 > 浏览</code> 然后选择脚本执行即可。</p>
<p>完整的代码如下：</p>
<pre><code class="language-JavaScript">app.preferences.rulerUnits = Units.PIXELS;
<span class="hljs-keyword">if</span> (app.documents.length > <span class="hljs-number">0</span>) {<span class="hljs-comment">//If there is file left open</span>
  alert(<span class="hljs-string">"Please close all open documents before running this script."</span>);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// The width and height for output. You may have to change this to make it dynamic.</span>
  <span class="hljs-keyword">var</span> finalWidth = <span class="hljs-number">1600</span>;
  <span class="hljs-keyword">var</span> finalHeight = <span class="hljs-number">1200</span>;
  <span class="hljs-comment">// Use folder selection dialogs to get the location of the input files</span>
  <span class="hljs-comment">// and where to save the new output files.</span>
  <span class="hljs-keyword">var</span> sourceFolder = Folder.selectDialog(<span class="hljs-string">"Please choose the source image folder."</span>, Folder.myDocuments);
  <span class="hljs-keyword">var</span> destFolder = Folder.selectDialog(<span class="hljs-string">"Please choose the target image folder"</span>, sourceFolder);
  <span class="hljs-keyword">var</span> watermarkFile = File.openDialog(<span class="hljs-string">"Please choose a watermark image file."</span>, <span class="hljs-string">"*.png"</span>)
  <span class="hljs-comment">// Consider only some images filetypes.</span>
  <span class="hljs-keyword">var</span> files = sourceFolder.getFiles(<span class="hljs-regexp">/.+\.(?:jpe?g|bmp|png)$/i</span>);
  <span class="hljs-keyword">var</span> numOfFiles = files.length;
  <span class="hljs-comment">//Iterate through folder</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++){
    <span class="hljs-keyword">var</span> f = files[i];
    <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> Folder) {<span class="hljs-comment">//if file is not folder, jump to next</span>
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">var</span> docRef = app.open(f);
    <span class="hljs-keyword">var</span> layerRef = docRef.activeLayer;
    <span class="hljs-comment">//Resize image according to shape</span>
    <span class="hljs-keyword">var</span> actualWidth = docRef.width;
    <span class="hljs-keyword">var</span> actualHeight = docRef.height;
    <span class="hljs-keyword">var</span> imgHeight = <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">var</span> imgWidth = actualWidth * imgHeight / actualHeight;
    <span class="hljs-keyword">if</span> (imgWidth > <span class="hljs-number">1333</span>) {
      imgWidth = <span class="hljs-number">1333</span>;
      imgHeight = actualHeight * imgWidth / actualWidth;
    }
    docRef.resizeImage(imgWidth,imgHeight);
    <span class="hljs-comment">//Resize canvas, keep img in center</span>
    docRef.resizeCanvas(finalWidth, finalHeight, AnchorPosition.MIDDLECENTER);
    <span class="hljs-comment">//Add watermark</span>
    app.bringToFront();
    <span class="hljs-keyword">var</span> logoFile = watermarkFile; 
    placeWatermark(logoFile);
    <span class="hljs-comment">//Merge visible layers, there is no mergeAllLayer function</span>
    <span class="hljs-keyword">try</span>{
        activeDocument.mergeVisibleLayers();
    } <span class="hljs-keyword">catch</span>(e) {}
    <span class="hljs-comment">//Get filename and extension to use it when saving.</span>
    <span class="hljs-keyword">var</span> fileExtension = getFileExtension(f.name);
    <span class="hljs-keyword">var</span> filename = getFilename(f.name);
    <span class="hljs-comment">//Create new image and save as JPG</span>
    <span class="hljs-keyword">var</span> outputFile = <span class="hljs-keyword">new</span> File(destFolder.absoluteURI + <span class="hljs-string">"/"</span> + filename + <span class="hljs-string">"."</span> + fileExtension);
    saveAsJPG(docRef, outputFile, <span class="hljs-number">10</span>);
    <span class="hljs-comment">//Close active document, this cannot be done w/o merging all layers</span>
    docRef.close();
  }
  alert(numOfFiles + <span class="hljs-string">" files have been processed."</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFileExtension</span>(<span class="hljs-params">fullFilename</span>) </span>{
  <span class="hljs-keyword">return</span> fullFilename.split(<span class="hljs-string">'.'</span>).pop();
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFilename</span>(<span class="hljs-params">fullFilename</span>) </span>{
  <span class="hljs-keyword">var</span> finalDotPosition = fullFilename.lastIndexOf(<span class="hljs-string">"."</span>) ;
  <span class="hljs-keyword">if</span> ( finalDotPosition > <span class="hljs-number">-1</span> ) {
    <span class="hljs-keyword">return</span> fullFilename.substr( <span class="hljs-number">0</span> , finalDotPosition );
  }
  <span class="hljs-keyword">return</span> fullFilename;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saveAsJPG</span>(<span class="hljs-params">docRef, saveFile, jpegQuality</span>) </span>{
  options = <span class="hljs-keyword">new</span> JPEGSaveOptions();
  options.quality = jpegQuality;
  docRef.saveAs(saveFile, options, <span class="hljs-literal">false</span>,Extension.LOWERCASE);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">placeWatermark</span>(<span class="hljs-params">Image</span>)</span>{  
  <span class="hljs-keyword">if</span>(!documents.length) {<span class="hljs-comment">// if no image is open then return</span>
    <span class="hljs-keyword">return</span>;
  } 
  <span class="hljs-keyword">var</span> fileObj = <span class="hljs-keyword">new</span> File(Image);<span class="hljs-comment">// the passed file</span>
  <span class="hljs-keyword">if</span>(!fileObj.exists){<span class="hljs-comment">// If watermark file does not exits tell user </span>
    alert(fileObj.name  + <span class="hljs-string">" does not exist!"</span>);<span class="hljs-comment">// Alert User </span>
    <span class="hljs-keyword">return</span>;
  }  
  <span class="hljs-keyword">try</span>{  
    <span class="hljs-keyword">var</span> doc = app.activeDocument;<span class="hljs-comment">// set Doc object to active document</span>
    app.displayDialogs = DialogModes.NO;<span class="hljs-comment">// Dialog off </span>
    <span class="hljs-keyword">var</span> strtRulerUnits = app.preferences.rulerUnits;<span class="hljs-comment">// Save Users ruler units </span>
    <span class="hljs-keyword">var</span> strtTypeUnits = app.preferences.typeUnits;<span class="hljs-comment">// Save Users Type units </span>
    app.preferences.rulerUnits = Units.PIXELS;<span class="hljs-comment">// work with pixels </span>
    app.preferences.typeUnits = TypeUnits.PIXELS;<span class="hljs-comment">// work with pixels </span>
    <span class="hljs-keyword">var</span> layers = app.activeDocument.layers;<span class="hljs-comment">// get layers</span>
    app.activeDocument.activeLayer = layers[<span class="hljs-number">0</span>];<span class="hljs-comment">// Target Top Layer</span>
    placeFile(fileObj);<span class="hljs-comment">// Place in file the Watermark png file</span>
  }
  <span class="hljs-keyword">catch</span>(e) { alert(e + <span class="hljs-string">': on line '</span> + e.line); }<span class="hljs-comment">// inform user of error</span>
  <span class="hljs-keyword">finally</span>{  
    app.preferences.rulerUnits = strtRulerUnits;<span class="hljs-comment">// Restore user ruler units  </span>
    app.preferences.typeUnits = strtTypeUnits;<span class="hljs-comment">// Restore user type units    </span>
  };
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">placeFile</span>(<span class="hljs-params">placeFile</span>) </span>{  
  <span class="hljs-keyword">var</span> desc21 = <span class="hljs-keyword">new</span> ActionDescriptor();  
  desc21.putPath( charIDToTypeID(<span class="hljs-string">'null'</span>), <span class="hljs-keyword">new</span> File(placeFile) );  
  desc21.putEnumerated( charIDToTypeID(<span class="hljs-string">'FTcs'</span>), charIDToTypeID(<span class="hljs-string">'QCSt'</span>), charIDToTypeID(<span class="hljs-string">'Qcsa'</span>) );  
  <span class="hljs-keyword">var</span> desc22 = <span class="hljs-keyword">new</span> ActionDescriptor();  
  desc22.putUnitDouble( charIDToTypeID(<span class="hljs-string">'Hrzn'</span>), charIDToTypeID(<span class="hljs-string">'#Pxl'</span>), <span class="hljs-number">0.000000</span> );  
  desc22.putUnitDouble( charIDToTypeID(<span class="hljs-string">'Vrtc'</span>), charIDToTypeID(<span class="hljs-string">'#Pxl'</span>), <span class="hljs-number">0.000000</span> );  
  desc21.putObject( charIDToTypeID(<span class="hljs-string">'Ofst'</span>), charIDToTypeID(<span class="hljs-string">'Ofst'</span>), desc22 );  
  executeAction( charIDToTypeID(<span class="hljs-string">'Plc '</span>), desc21, DialogModes.NO );  
}
</code></pre>
<h1><a id="_147"></a>心得体会</h1>
<p>这次真的觉得“JavaScript南波湾”不是一句空话，到目前为止我想做的所有跟技术相关的事情几乎都可以用 JavaScript 来完成，这本身就是十分值得惊叹的一件事。</p>
<p>不过网上好像找不到系统学习 Photoshop 专用的 JavaScript 代码的教程，那我就只能下次再有别的需求的时候再学别的了。</p>
<p>在这里给 JavaScript 点个赞！</p>
</article> <div class="prev-next"><a href="/blogs/2020-04-05-set-up-static-blog-using-nuxt-en" class="no-decor-link"><div class="prev"><p>上一篇</p></div></a> <!----></div> <div><h3 style="text-align:center"><span style="border-bottom:2px solid #000">相关文章</span></h3> <div class="blog-gallery"><div class="blog-gallery-unit"><a href="/blogs/2020-01-31-a-little-summary-of-my-life-in-2019" title="我的2019年过得还算充实，看了很多剧，追了很多星，做了很多事，还学了很多东西，要继续保持。
" class="no-decor-link"><div class="blog-gallery-inner align-left"><h4>2019年的小总结</h4> <p class="blog-date"><span class="fa fa-calendar">
               2020-01-31
            </span></p> <p class="align-left"><span class="blog-gallery-desc">我的2019年过得还算充实，看了很多剧，追了很多星，做了很多事，还学了很多东西，要继续保持。
</span> <br> <span class="align-left"><span class="blog-gallery-tag">
                小日常
              </span><span class="blog-gallery-tag">
                剧评
              </span><span class="blog-gallery-tag">
                追星
              </span><span class="blog-gallery-tag">
                涨知识
              </span><span class="blog-gallery-tag">
                JavaScript
              </span></span></p></div></a></div></div></div> <div id="comment"></div></section></div></main> <footer><p>Created with Nuxt.js <br>
    	Made by  
    	<a href="https://github.com/c53hzn" target="_blank" class="no-decor-link"><strong>Jenny HOU</strong> <i class="fa fa-github font-20"></i></a></p> <div class="go-top go-top-hidden"><div class="arrow"></div> <div class="stick"></div></div></footer></div></div></div><script>window.__NUXT__=function(s,a,n,e,l,p,t){return n[0]="涨知识",n[1]=l,n[2]="Photoshop",n[3]="批处理",{layout:"page",data:[{blog:{layout:a,title:"用JavaScript写一个Photoshop批处理脚本",description:"我攒了一个可以在Photoshop里批量调整图像大小和画布大小、添加水印、另存为的JavaScript脚本，又学到了不少东西。",tags:n,related_blog:[p],author:t,comments:!0,slug:"2020-04-12-script-for-photoshop-bulk-resize-and-watermark",content:'<p><h3> </h3><ul><li><a href="#_JavaScript__Photoshop__1">用 JavaScript 写 Photoshop 批处理脚本的契机</a></li><li><a href="#_JavaScript__15">网上搜到可参考的 JavaScript 脚本</a></li><li><a href="#_28">改写成适合我自己情况的脚本</a></li><li><a href="#_147">心得体会</a></li></ul></p>\n<h1><a id="_JavaScript__Photoshop__1"></a>用 JavaScript 写 Photoshop 批处理脚本的契机</h1>\n<p>最近需要给一批图片加水印，用 Photoshop 手动做了三张之后我就开始琢磨能不能用一些技术手段来加快处理。</p>\n<p>以前处理图片的时候用过 <code>动作（Actions）</code>，这样可以一键完成多步重复性动作，比如调整图像大小和画布大小，然后置入水印图片、合并图层、保存到另一文件夹，这都是可以做到的。</p>\n<p>但是 <code>动作</code> 的局限性在于无法根据要处理的图片的形状和尺寸来决定调整图像大小和画布大小的方式，而我要处理的图片就没有形状一样的，有的要以宽度为基准来缩放，有的要以高度为基准来缩放，这样第一步就错了，后面也就没有意义了。</p>\n<p>于是我在 Google 上搜索相关信息，看看 <code>动作</code> 有没有个性化设置的可能，然后发现是可以的，但是能用来判断的条件还是太少了，不符合我的要求。</p>\n<p>接着就看到有人说，可以试一下用 <code>脚本（Scripts）</code> 来处理，于是又研究了下，发现 Photoshop 接受三种语言写成的脚本： <code>AppleScript</code>、<code>JavaScript</code> 和 <code>VBScript</code>。</p>\n<p>这不是巧了嘛！天下脚本千千万，JavaScript南波湾！那我们就开始抄，哦不，开始学吧！</p>\n<h1><a id="_JavaScript__15"></a>网上搜到可参考的 JavaScript 脚本</h1>\n<p>我在 Google 上搜到 3 个可用的用 JavaScript 写成的 Photoshop 脚本：</p>\n<ol>\n<li><a href="https://ricardomoinhos.com/photoshop-scripting/" title="Photoshop Scripting – Batch resizing image size and image canvas">Photoshop脚本——批量调整图像大小和画布大小</a><br>\n这个脚本主要写的是指定一个源文件夹和目标文件夹，经过一番处理之后把源文件夹里的图片保存到目标文件夹里。他的一番处理里面包括了图像大小和画布大小，这些改一改就可以用了。</li>\n<li><a href="http://www.mouseprints.net/old/dpr/PlaceWatermark.jsx" title="JJMack\'s PlaceWatermark">JJMack的置入水印脚本</a><br>\n这个脚本写的是怎么加水印和调整水印在图片上的位置，由于我要加的水印尺寸和最终需要的画布大小一致，也不需要调整位置，所以有些步骤就删掉了。</li>\n<li><a href="https://community.adobe.com/t5/photoshop/help-need-a-script-to-merge-all-layers-even-if-there-is-only-one-layer/td-p/3301907?page=1" title="Merge all visible layers">合并所有可见图层</a><br>\n我需要一个“合并所有图层”的写法，所以也参考了这个帖子。Photoshop脚本的默认功能里面好像只有“合并所有可见图层”，但是因为这次的操作不会用到隐藏图层，所以这样应该就够了。</li>\n</ol>\n<p>有以上 3 个脚本，基本上就满足我的需求了。</p>\n<h1><a id="_28"></a>改写成适合我自己情况的脚本</h1>\n<p>其实我要对图片进行的处理很简单，根据图片的形状，把它的图像大小按比例缩放成不超过 <code>1333 x 1000 px</code> 的尺寸，然后扩展画布大小变成 <code>1600 x 1200 px</code> 的尺寸，然后再把一个 <code>1600 x 1200 px</code> 的水印图片导入进来，合并水印图层和背景图层，另存进一个新的文件夹，完事。</p>\n<p>如果手动操作，差不多30秒可以完成一张图，但是如果用代码，不仅能提高速度，还可以解放我的双手，有这时间多刷刷微博也是好的呀。</p>\n<p>需要注意的是 Photoshop 用的 JS 代码需要保存成 <code>.jsx</code> 格式的文件，使用时点击 <code>文件 &gt; 脚本 &gt; 浏览</code> 然后选择脚本执行即可。</p>\n<p>完整的代码如下：</p>\n<pre><code class="language-JavaScript">app.preferences.rulerUnits = Units.PIXELS;\n<span class="hljs-keyword">if</span> (app.documents.length &gt; <span class="hljs-number">0</span>) {<span class="hljs-comment">//If there is file left open</span>\n  alert(<span class="hljs-string">"Please close all open documents before running this script."</span>);\n} <span class="hljs-keyword">else</span> {\n  <span class="hljs-comment">// The width and height for output. You may have to change this to make it dynamic.</span>\n  <span class="hljs-keyword">var</span> finalWidth = <span class="hljs-number">1600</span>;\n  <span class="hljs-keyword">var</span> finalHeight = <span class="hljs-number">1200</span>;\n  <span class="hljs-comment">// Use folder selection dialogs to get the location of the input files</span>\n  <span class="hljs-comment">// and where to save the new output files.</span>\n  <span class="hljs-keyword">var</span> sourceFolder = Folder.selectDialog(<span class="hljs-string">"Please choose the source image folder."</span>, Folder.myDocuments);\n  <span class="hljs-keyword">var</span> destFolder = Folder.selectDialog(<span class="hljs-string">"Please choose the target image folder"</span>, sourceFolder);\n  <span class="hljs-keyword">var</span> watermarkFile = File.openDialog(<span class="hljs-string">"Please choose a watermark image file."</span>, <span class="hljs-string">"*.png"</span>)\n  <span class="hljs-comment">// Consider only some images filetypes.</span>\n  <span class="hljs-keyword">var</span> files = sourceFolder.getFiles(<span class="hljs-regexp">/.+\\.(?:jpe?g|bmp|png)$/i</span>);\n  <span class="hljs-keyword">var</span> numOfFiles = files.length;\n  <span class="hljs-comment">//Iterate through folder</span>\n  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; files.length; i++){\n    <span class="hljs-keyword">var</span> f = files[i];\n    <span class="hljs-keyword">if</span> (f <span class="hljs-keyword">instanceof</span> Folder) {<span class="hljs-comment">//if file is not folder, jump to next</span>\n      <span class="hljs-keyword">continue</span>;\n    }\n    <span class="hljs-keyword">var</span> docRef = app.open(f);\n    <span class="hljs-keyword">var</span> layerRef = docRef.activeLayer;\n    <span class="hljs-comment">//Resize image according to shape</span>\n    <span class="hljs-keyword">var</span> actualWidth = docRef.width;\n    <span class="hljs-keyword">var</span> actualHeight = docRef.height;\n    <span class="hljs-keyword">var</span> imgHeight = <span class="hljs-number">1000</span>;\n    <span class="hljs-keyword">var</span> imgWidth = actualWidth * imgHeight / actualHeight;\n    <span class="hljs-keyword">if</span> (imgWidth &gt; <span class="hljs-number">1333</span>) {\n      imgWidth = <span class="hljs-number">1333</span>;\n      imgHeight = actualHeight * imgWidth / actualWidth;\n    }\n    docRef.resizeImage(imgWidth,imgHeight);\n    <span class="hljs-comment">//Resize canvas, keep img in center</span>\n    docRef.resizeCanvas(finalWidth, finalHeight, AnchorPosition.MIDDLECENTER);\n    <span class="hljs-comment">//Add watermark</span>\n    app.bringToFront();\n    <span class="hljs-keyword">var</span> logoFile = watermarkFile; \n    placeWatermark(logoFile);\n    <span class="hljs-comment">//Merge visible layers, there is no mergeAllLayer function</span>\n    <span class="hljs-keyword">try</span>{\n        activeDocument.mergeVisibleLayers();\n    } <span class="hljs-keyword">catch</span>(e) {}\n    <span class="hljs-comment">//Get filename and extension to use it when saving.</span>\n    <span class="hljs-keyword">var</span> fileExtension = getFileExtension(f.name);\n    <span class="hljs-keyword">var</span> filename = getFilename(f.name);\n    <span class="hljs-comment">//Create new image and save as JPG</span>\n    <span class="hljs-keyword">var</span> outputFile = <span class="hljs-keyword">new</span> File(destFolder.absoluteURI + <span class="hljs-string">"/"</span> + filename + <span class="hljs-string">"."</span> + fileExtension);\n    saveAsJPG(docRef, outputFile, <span class="hljs-number">10</span>);\n    <span class="hljs-comment">//Close active document, this cannot be done w/o merging all layers</span>\n    docRef.close();\n  }\n  alert(numOfFiles + <span class="hljs-string">" files have been processed."</span>);\n}\n\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFileExtension</span>(<span class="hljs-params">fullFilename</span>) </span>{\n  <span class="hljs-keyword">return</span> fullFilename.split(<span class="hljs-string">\'.\'</span>).pop();\n}\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getFilename</span>(<span class="hljs-params">fullFilename</span>) </span>{\n  <span class="hljs-keyword">var</span> finalDotPosition = fullFilename.lastIndexOf(<span class="hljs-string">"."</span>) ;\n  <span class="hljs-keyword">if</span> ( finalDotPosition &gt; <span class="hljs-number">-1</span> ) {\n    <span class="hljs-keyword">return</span> fullFilename.substr( <span class="hljs-number">0</span> , finalDotPosition );\n  }\n  <span class="hljs-keyword">return</span> fullFilename;\n}\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">saveAsJPG</span>(<span class="hljs-params">docRef, saveFile, jpegQuality</span>) </span>{\n  options = <span class="hljs-keyword">new</span> JPEGSaveOptions();\n  options.quality = jpegQuality;\n  docRef.saveAs(saveFile, options, <span class="hljs-literal">false</span>,Extension.LOWERCASE);\n}\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">placeWatermark</span>(<span class="hljs-params">Image</span>)</span>{  \n  <span class="hljs-keyword">if</span>(!documents.length) {<span class="hljs-comment">// if no image is open then return</span>\n    <span class="hljs-keyword">return</span>;\n  } \n  <span class="hljs-keyword">var</span> fileObj = <span class="hljs-keyword">new</span> File(Image);<span class="hljs-comment">// the passed file</span>\n  <span class="hljs-keyword">if</span>(!fileObj.exists){<span class="hljs-comment">// If watermark file does not exits tell user </span>\n    alert(fileObj.name  + <span class="hljs-string">" does not exist!"</span>);<span class="hljs-comment">// Alert User </span>\n    <span class="hljs-keyword">return</span>;\n  }  \n  <span class="hljs-keyword">try</span>{  \n    <span class="hljs-keyword">var</span> doc = app.activeDocument;<span class="hljs-comment">// set Doc object to active document</span>\n    app.displayDialogs = DialogModes.NO;<span class="hljs-comment">// Dialog off </span>\n    <span class="hljs-keyword">var</span> strtRulerUnits = app.preferences.rulerUnits;<span class="hljs-comment">// Save Users ruler units </span>\n    <span class="hljs-keyword">var</span> strtTypeUnits = app.preferences.typeUnits;<span class="hljs-comment">// Save Users Type units </span>\n    app.preferences.rulerUnits = Units.PIXELS;<span class="hljs-comment">// work with pixels </span>\n    app.preferences.typeUnits = TypeUnits.PIXELS;<span class="hljs-comment">// work with pixels </span>\n    <span class="hljs-keyword">var</span> layers = app.activeDocument.layers;<span class="hljs-comment">// get layers</span>\n    app.activeDocument.activeLayer = layers[<span class="hljs-number">0</span>];<span class="hljs-comment">// Target Top Layer</span>\n    placeFile(fileObj);<span class="hljs-comment">// Place in file the Watermark png file</span>\n  }\n  <span class="hljs-keyword">catch</span>(e) { alert(e + <span class="hljs-string">\': on line \'</span> + e.line); }<span class="hljs-comment">// inform user of error</span>\n  <span class="hljs-keyword">finally</span>{  \n    app.preferences.rulerUnits = strtRulerUnits;<span class="hljs-comment">// Restore user ruler units  </span>\n    app.preferences.typeUnits = strtTypeUnits;<span class="hljs-comment">// Restore user type units    </span>\n  };\n}\n<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">placeFile</span>(<span class="hljs-params">placeFile</span>) </span>{  \n  <span class="hljs-keyword">var</span> desc21 = <span class="hljs-keyword">new</span> ActionDescriptor();  \n  desc21.putPath( charIDToTypeID(<span class="hljs-string">\'null\'</span>), <span class="hljs-keyword">new</span> File(placeFile) );  \n  desc21.putEnumerated( charIDToTypeID(<span class="hljs-string">\'FTcs\'</span>), charIDToTypeID(<span class="hljs-string">\'QCSt\'</span>), charIDToTypeID(<span class="hljs-string">\'Qcsa\'</span>) );  \n  <span class="hljs-keyword">var</span> desc22 = <span class="hljs-keyword">new</span> ActionDescriptor();  \n  desc22.putUnitDouble( charIDToTypeID(<span class="hljs-string">\'Hrzn\'</span>), charIDToTypeID(<span class="hljs-string">\'#Pxl\'</span>), <span class="hljs-number">0.000000</span> );  \n  desc22.putUnitDouble( charIDToTypeID(<span class="hljs-string">\'Vrtc\'</span>), charIDToTypeID(<span class="hljs-string">\'#Pxl\'</span>), <span class="hljs-number">0.000000</span> );  \n  desc21.putObject( charIDToTypeID(<span class="hljs-string">\'Ofst\'</span>), charIDToTypeID(<span class="hljs-string">\'Ofst\'</span>), desc22 );  \n  executeAction( charIDToTypeID(<span class="hljs-string">\'Plc \'</span>), desc21, DialogModes.NO );  \n}\n</code></pre>\n<h1><a id="_147"></a>心得体会</h1>\n<p>这次真的觉得“JavaScript南波湾”不是一句空话，到目前为止我想做的所有跟技术相关的事情几乎都可以用 JavaScript 来完成，这本身就是十分值得惊叹的一件事。</p>\n<p>不过网上好像找不到系统学习 Photoshop 专用的 JavaScript 代码的教程，那我就只能下次再有别的需求的时候再学别的了。</p>\n<p>在这里给 JavaScript 点个赞！</p>\n',prev:"2020-04-05-set-up-static-blog-using-nuxt-en"},tags:n,date:"2020-04-12",relatedBlog:[{layout:a,title:"2019年的小总结",description:"我的2019年过得还算充实，看了很多剧，追了很多星，做了很多事，还学了很多东西，要继续保持。\n",related_blog:["2019-08-17-tv-drama-the-birth-of-the-drama-king","2019-05-05-set-up-static-blog-using-nuxt","2020-02-13-tv-drama-die-now"],tags:["小日常","剧评","追星","涨知识",l],author:t,comments:!0,slug:p,prev:"2019-12-28-why-vlookup-cannot-return-value",next:"2020-02-01-memories-about-plagues",date:"2020-01-31"}],baseURL:"/",ui_str:{to_prev:"上一篇",to_next:"下一篇",related_posts:"相关文章"}}],error:null,serverRendered:!0}}(0,"post",Array(4),0,"JavaScript","2020-01-31-a-little-summary-of-my-life-in-2019","author1")</script><script src="/_nuxt/d62a008b225084d4add7.js" defer></script><script src="/_nuxt/b4d4a0baed0e9fb51d3e.js" defer></script><script src="/_nuxt/e538c0d34daa29c0b6a1.js" defer></script><script src="/_nuxt/7c2eafc52e6930abbe67.js" defer></script>
  </body>
</html>
